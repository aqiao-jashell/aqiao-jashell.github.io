

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="CNAQ">
  <meta name="keywords" content="">
  
    <meta name="description" content="0x00  前言代码审计指的是对源代码进行检查，寻找代码中的bug以及安全缺陷(漏洞)。本文章主要是PHP代码审计的一些基础知识，包括函数的用法，漏洞点，偏向基础部分，先记住一句话”一切存在用户输入的地方都有可能存在漏洞”。 0x01  代码执行代码执行是代码审计当中较为严重的漏洞，主要是一些命令执行函数的不适当使用。那么，常见的能够触发这类漏洞的函数有哪些呢？  eval()  想必大家对eva">
<meta property="og:type" content="article">
<meta property="og:title" content="php代码审计基础">
<meta property="og:url" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="一只鲶鱼">
<meta property="og:description" content="0x00  前言代码审计指的是对源代码进行检查，寻找代码中的bug以及安全缺陷(漏洞)。本文章主要是PHP代码审计的一些基础知识，包括函数的用法，漏洞点，偏向基础部分，先记住一句话”一切存在用户输入的地方都有可能存在漏洞”。 0x01  代码执行代码执行是代码审计当中较为严重的漏洞，主要是一些命令执行函数的不适当使用。那么，常见的能够触发这类漏洞的函数有哪些呢？  eval()  想必大家对eva">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/001.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/002.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/003.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/004.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/005.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/006.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/007.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/008.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/009.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/010.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/011.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/012.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/013.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/014.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/015.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/016.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/017.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/018.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/019.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/020.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/021.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/022.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/023.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/024.png">
<meta property="og:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/025.png">
<meta property="article:published_time" content="2024-09-20T06:21:43.000Z">
<meta property="article:modified_time" content="2025-07-18T01:26:56.706Z">
<meta property="article:author" content="CNAQ">
<meta property="article:tag" content="代码审计">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://aqiao-jashell.github.io/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/001.png">
  
  
  
  <title>php代码审计基础 - 一只鲶鱼</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"aqiao-jashell.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"uOGt77jvpFaYohTodQumjdZC-gzGzoHsz","app_key":"31Yh2ERJg2UAciRs4CWKtJTr","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>一只鲶鱼</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="php代码审计基础"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-09-20 14:21" pubdate>
          2024年9月20日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          95 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">php代码审计基础</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00  前言"></a><strong>0x00  前言</strong></h2><p>代码审计指的是对源代码进行检查，寻找代码中的bug以及安全缺陷(漏洞)。本文章主要是PHP代码审计的一些基础知识，包括函数的用法，漏洞点，偏向基础部分，先记住一句话”一切存在用户输入的地方都有可能存在漏洞”。</p>
<h2 id="0x01-代码执行"><a href="#0x01-代码执行" class="headerlink" title="0x01  代码执行"></a><strong>0x01  代码执行</strong></h2><p>代码执行是代码审计当中较为严重的漏洞，主要是一些命令执行函数的不适当使用。那么，常见的能够触发这类漏洞的函数有哪些呢？</p>
<ul>
<li><h3 id="eval"><a href="#eval" class="headerlink" title="eval()"></a><strong>eval()</strong></h3></li>
</ul>
<p>想必大家对eval()函数应该并不陌生，简而言之eval()函数就是将传入的字符串当作 PHP 代码来进行执行。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">eval</span>( <span class="hljs-keyword">string</span> <span class="hljs-variable">$code</span>) : <span class="hljs-keyword">mixed</span><br></code></pre></td></tr></table></figure>

<p>返回值 </p>
<p>eval() 返回 NULL，除非在执行的代码中 return了一个值，函数返回传递给 return的值。PHP7开始，执行的代码里如果有一个parse error，eval() 会抛出 ParseError 异常。在 PHP 7 之前，如果在执行的代码中有 parse error，eval() 返回FALSE，之后的代码将正常执行。无法使用set_error_handler()捕获 eval() 中的解析错误。</p>
<p>也就是说，我们在利用eval()函数的时候，如果我们传入的字符串不是正常的代码格式，那么就会抛出异常。所以PHP7和PHP5在这部分最大的不同是什么呢？简而言之，PHP5在代码错误格式错误之后仍会执行，而PHP7在代码发生错误之后，那么eval()函数就会抛出异常，而不执行之后的代码。</p>
<p>示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$code</span> = <span class="hljs-string">&quot;echo &#x27;This is a PHP7&#x27;;&quot;</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;This is a PHP7</p>
<p>那么如果我要执行系统命令呢？这个时候就需要用到PHP中的system函数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$code</span> = <span class="hljs-string">&quot;system(&#x27;whoami&#x27;);&quot;</span>;<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;����\cnaqadmin</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/001.png" srcset="/img/loading.gif" lazyload class="" title="图片一">

<p>那么到此，我们就可以结合其他姿势通过这个函数实现任意代码执行了。</p>
<ul>
<li><h3 id="assert"><a href="#assert" class="headerlink" title="assert()"></a><strong>assert()</strong></h3></li>
</ul>
<p>PHP 5</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">assert</span>( <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$assertion</span>[, <span class="hljs-keyword">string</span> <span class="hljs-variable">$description</span>] ) : <span class="hljs-keyword">bool</span><br></code></pre></td></tr></table></figure>

<p>PHP 7</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">assert</span>( <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$assertion</span>[, <span class="hljs-built_in">Throwable</span> <span class="hljs-variable">$exception</span>] ) : <span class="hljs-keyword">bool</span><br></code></pre></td></tr></table></figure>

<p>参数 </p>
<ul>
<li><strong>assertion</strong></li>
</ul>
<p>断言。在PHP 5 中，是一个用于执行的字符串或者用于测试的布尔值。在PHP 7 中，可以是一个返回任何值的表达式，它将被执行结果用于判断断言是否成功。</p>
<ul>
<li><strong>description</strong></li>
</ul>
<p>如果assertion失败了，选项description将会包含在失败信息里。</p>
<ul>
<li><strong>exception</strong></li>
</ul>
<p>在PHP 7中，第二个参数可以是一个Throwable对象，而不是一个字符串，如果断言失败且启用了assert.exception，那么该对象将被抛出。</p>
<p>assert()配置 </p>
<table>
<thead>
<tr>
<th align="center"><strong>配置项</strong></th>
<th align="center"><strong>默认值</strong></th>
<th align="left"><strong>可选值</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">zend.assertions</td>
<td align="center">1</td>
<td align="left">1 - 生成和执行代码(开发模式) 0 - 生成代码，但在执行时跳过它 -1 - 不生成代码(生产环境)</td>
</tr>
<tr>
<td align="center">assert.exception</td>
<td align="center">0</td>
<td align="left">1 - 断言失败时抛出，可以抛出异常对象，如果没有提供异常，则抛出AssertionError对象实例 0 - 使用或生成Throwable，仅仅是基于对象生成的警告而不是抛出对象(与PHP 5 兼容)</td>
</tr>
</tbody></table>
<p>所以搞了这么多，assert()函数到底是干什么的呢？用我的理解来说，assert()函数是处理异常的一种形式，相当于一个if条件语句的宏定义一样。</p>
<p>一个PHP 7 中的示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>assert\<span class="hljs-title function_ invoke__">_options</span>(ASSERT\_EXCEPTION, <span class="hljs-number">1</span>);    <span class="hljs-comment">// 设置在断言失败时产生异常</span><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-number">1</span> == <span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">AssertionError</span>(<span class="hljs-string">&#x27;因为1不等于2，所以前面断言失败，抛出异常&#x27;</span>));  <span class="hljs-comment">// 用 AssertionError 异常替代普通字符串</span><br>&#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Throwable</span> <span class="hljs-variable">$error</span>) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$error</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<br>&#125;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;因为1不等于2，所以前面断言失败，抛出异常</p>
<p>这里就是实例化一个对象，用这个对象来抛出异常。</p>
<p>一个php 5 中的示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-number">1</span> == <span class="hljs-number">2</span>,<span class="hljs-string">&#x27;前面断言失败，抛出异常&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;Warning: assert(): 前面断言失败，抛出异常 failed in D:\phpstudy_pro\WWW\1.php on line 2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-number">1</span> == <span class="hljs-number">2</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;Warning: assert(): Assertion failed in D:\phpstudy_pro\WWW\1.php on line 2</p>
<p>所以PHP 7 相较于PHP 5 就是多了个用Throwable来发出警告。</p>
<p>那么，如果前面断言成功呢？会发生什么呢?来个最简单，也是我们比较喜欢的示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$code</span> = <span class="hljs-string">&quot;system(whoami)&quot;</span><br><span class="hljs-title function_ invoke__">assert</span>(<span class="hljs-variable">$code</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;����\cnaqadmin</p>
<p>这段代码在PHP 5 和PHP 7 中都会返回命令执行结果，虽然PHP 7 中对断言函数的参数稍作了改变，但是为了兼容低版本，所以还是会直接返回结果。</p>
<ul>
<li><h3 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace()"></a><strong>preg_replace()</strong></h3></li>
</ul>
<p>通过函数名字我们也应该能够了解函数大概作用，此函数执行一个正则表达式的搜索和替换。</p>
<p>mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit &#x3D; -1 [, int &amp;$count ]] )</p>
<p>搜索 subject 中匹配 pattern 的部分， 以 replacement 进行替换。</p>
<p>参数说明： </p>
<ul>
<li>$pattern: 要搜索的模式，可以是字符串或一个字符串数组。</li>
<li>$replacement: 用于替换的字符串或字符串数组。</li>
<li>$subject: 要搜索替换的目标字符串或字符串数组。</li>
<li>$limit: 可选，对于每个模式用于每个 subject 字符串的最大可替换次数。 默认是-1（无限制）。</li>
<li>$count: 可选，为替换执行的次数。</li>
</ul>
<p>那这个函数跟我们命令执行有什么关系呢？仅仅看上面的官方解释似乎看不出什么，但是preg_repace()有一个模式是&#x2F;e模式，这个模式就会发生代码执行的问题，为什么呢？</p>
<p>看一个案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Ameng</span>(<span class="hljs-params"><span class="hljs-variable">$regex</span>, <span class="hljs-variable">$value</span></span>)</span>&#123;<br><span class="hljs-keyword">return</span> preg\<span class="hljs-title function_ invoke__">_replace</span>(<span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$regex</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>, <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, <span class="hljs-variable">$value</span>);<br>&#125;<br><span class="hljs-keyword">foreach</span> ($\_GET <span class="hljs-keyword">as</span> <span class="hljs-variable">$regex</span> =&gt; <span class="hljs-variable">$value</span>)&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">Ameng</span>(<span class="hljs-variable">$regex</span>, <span class="hljs-variable">$value</span>) . <span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>上面这段我们需要注意的就是\1,\1在正则表达式是反向引用的意思，简而言之就是指定一个子匹配项。</p>
<p>针对上面案例，我们来个payload：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">payload</span>=/?.\*=&#123;<span class="hljs-variable">$&#123;phpinfo()&#125;</span>&#125;<br></code></pre></td></tr></table></figure>

<p>所以语句就成了这样preg_replace(‘&#x2F;(.*)&#x2F;ei’, ‘strtolower(“\1”)’, {${phpinfo()}});</p>
<p>那么我们直接把这段代码放到页面</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>preg\<span class="hljs-title function_ invoke__">_replace</span>(<span class="hljs-string">&#x27;/(.\*)/ei&#x27;</span>, <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, <span class="hljs-string">&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>访问页面，结果如下：</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/002.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>我们看到成功执行了代码。</p>
<p>但是这里我是直接将这段代码写到了文件里，那么如果我们是通过GET传参得到参数，这里针对上面那个案例就需要注意一点，在通过GET传参时，.*会被替换为_*导致我们要的正则被替换了，达不到我们的效果，所以这里可用使用一些其他的正则表达式来达到目的，比如通过GET传参时我们的参数可以传入\S*从而达到同样目的。所以以后再遇到这个函数的时候，要留个心眼了。不过，这里要补充一点，就是preg_replace()函数在PHP 7 后便不再支持，使用preg_replace_callback()进行替换了，取消了不安全的\e模式。</p>
<ul>
<li><h3 id="create-function"><a href="#create-function" class="headerlink" title="create_function()"></a><strong>create_function()</strong></h3></li>
</ul>
<p> <br>create_function()用来创建一个匿名函数</p>
<p>create_function( string $args, string $code) : string</p>
<p>参数</p>
<ul>
<li>string $args 声明的函数变量部分</li>
<li>string $code 要执行的代码</li>
</ul>
<p>返回值</p>
<p>返回唯一的函数名称作为字符串或者返回FALSE错误</p>
<p>create_function()函数在内部执行eval()函数，所以我们就可以利用这一点，来执行代码。当然正因为存在安全问题，所以在PHP 7.2 之后的版本中已经废弃了create_function()函数，使用匿名函数来代替。所以这里为了演示这个函数，我采用的是PHP 5 的环境。那么这个函数到底怎么用呢？</p>
<p>那么来看我写的一个简单的案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$onefunc</span> = create\<span class="hljs-title function_ invoke__">_function</span>(<span class="hljs-string">&#x27;$a&#x27;</span>,<span class="hljs-string">&#x27;return system($a);&#x27;</span>);<br><span class="hljs-variable">$onefunc</span>(whoami);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;����\cnaqadmin</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/003.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>我们看到使用此函数为我们相当于创造了一个匿名的函数，给它赋以相应的变量，就执行了我们要执行的代码。</p>
<p>那么接下来我们来看一个简单的案例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error\<span class="hljs-title function_ invoke__">_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$sort</span>\_by = $\_GET[<span class="hljs-string">&#x27;sort\_by&#x27;</span>];<br><span class="hljs-variable">$sorter</span> = <span class="hljs-string">&#x27;strnatcasecmp&#x27;</span>;<br><span class="hljs-variable">$databases</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;1234&#x27;</span>,<span class="hljs-string">&#x27;4321&#x27;</span>);<br><span class="hljs-variable">$sort</span>\_function = <span class="hljs-string">&#x27; return 1 \* &#x27;</span> . <span class="hljs-variable">$sorter</span> . <span class="hljs-string">&#x27;($a[&quot;&#x27;</span> . <span class="hljs-variable">$sort</span>\_by . <span class="hljs-string">&#x27;&quot;], $b[&quot;&#x27;</span> . <span class="hljs-variable">$sort</span>\_by . <span class="hljs-string">&#x27;&quot;]);&#x27;</span>;<br><span class="hljs-title function_ invoke__">usort</span>(<span class="hljs-variable">$databases</span>, create\<span class="hljs-title function_ invoke__">_function</span>(<span class="hljs-string">&#x27;$a, $b&#x27;</span>, <span class="hljs-variable">$sort</span>\_function));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这个主要功能就是实现排序，这段代码就调用了create_function()函数，那么我们能否利用这个函数执行我们想要执行的代码呢？</p>
<p>当然可以，我们只需要在传参时将前面的符号闭合，然后输入我们想要执行的代码即可。</p>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs puppet">payload=<span class="hljs-string">&#x27;&quot;]);&#125;phpinfo();/\*</span><br><span class="hljs-string"></span><br><span class="hljs-string">执行payload前：<span class="hljs-variable">$sort</span>\_function = &#x27;</span> return 1 \* <span class="hljs-string">&#x27; . <span class="hljs-variable">$sorter</span> . &#x27;</span>(<span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;&#x27; . <span class="hljs-variable">$sort</span>\_by . &#x27;&quot;</span>], <span class="hljs-variable">$b</span>[<span class="hljs-string">&quot;&#x27; . <span class="hljs-variable">$sort</span>\_by . &#x27;&quot;</span>]);<span class="hljs-string">&#x27;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">执行payloda后：<span class="hljs-variable">$sort</span>\_function = &#x27;</span> return 1 \* <span class="hljs-string">&#x27; . <span class="hljs-variable">$sorter</span> . &#x27;</span>(<span class="hljs-variable">$a</span>[<span class="hljs-string">&quot;&#x27; . <span class="hljs-variable">$sort</span>\_by &#x27;&quot;</span>]);&#125;phpinfo();/\*<br></code></pre></td></tr></table></figure>

<p>看到这里，你可能会有稍微疑惑，就是你闭合就闭合吧，为什么后面多了个;}，不知道你是否想到了这一点？</p>
<p>那么我就来分析一下这个，上面的那段执行代码，实际上就是一个匿名函数的创建，既然是一个函数，注意是一个函数，那么你觉得有没有花括号呢？看我如下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//未闭合之前</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sort</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span></span>)</span>&#123;<br><span class="hljs-string">&#x27; return 1 \* &#x27;</span> . <span class="hljs-variable">$sorter</span> . <span class="hljs-string">&#x27;($a[&quot;&#x27;</span> . <span class="hljs-variable">$sort</span>\_by . <span class="hljs-string">&#x27;&quot;], $b[&quot;&#x27;</span> . <span class="hljs-variable">$sort</span>\_by . <span class="hljs-string">&#x27;&quot;]);&#x27;</span>;<br>&#125;<br><span class="hljs-comment">//闭合之后</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sort</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span></span>)</span>&#123;<br><span class="hljs-string">&#x27; return 1 \* &#x27;</span> . <span class="hljs-variable">$sorter</span> . <span class="hljs-string">&#x27;($a[&quot;&#x27;</span> . <span class="hljs-variable">$sort</span>\_by <span class="hljs-string">&#x27;&quot;]);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">phpinfo();/\*</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>可以看到，我们借用了匿名函数的位置，插入了我们要执行的代码，然后等这个匿名函数被create_function当作$code执行的时候，是不是代码就被执行了。</p>
<p>结果：</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/004.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>那么creat_function函数还有别的用法吗？我们将上面一个案例简单的修改一下，代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$onefunc</span> = create\<span class="hljs-title function_ invoke__">_function</span>(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;die(`cat flag.php`)&quot;</span>);<br>$\_GET[<span class="hljs-string">&#x27;func\_name&#x27;</span>]();<br><span class="hljs-keyword">die</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>代码简单的来看，我们只需要执行$onefunc就能得到flag，但是我们不知道这个函数的名称。如果在不知道函数名称的情况下执行函数呢？这里就用到了creat_function函数的一个漏洞。这个函数在creat之后会自动生成一个函数名为%00lambda_%d的匿名函数。%d的值是一直递增的，会一直递增到最大长度直到结束。所以这里可以通过多进程或者多线程访问，从而看到flag。</p>
<p>所以，以后再代码中如果看到调用create_function()要小心一点，但是如果是CTF题目的话，不会这么直接就吧这个函数暴露给你，它可能会用到拼接或者替换来构造这个函数。最后再强调一下，create_function函数在PHP 7.2 版本之后就已经被废弃了。</p>
<ul>
<li><h3 id="array-map"><a href="#array-map" class="headerlink" title="array_map()"></a><strong>array_map()</strong></h3></li>
</ul>
<p>array_map()为数组的每个元素应用回调函数</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">array\_map( callable $callback,<span class="hljs-built_in"> array </span>$array1[,<span class="hljs-built_in"> array </span>$...] )<span class="hljs-keyword"> :</span> array<br></code></pre></td></tr></table></figure>

<p>array_map()：返回数组，是为 array1 每个元素应用 callback函数之后的数组。callback 函数形参的数量和传给array_map() 数组数量，两者必须一样。</p>
<p>参数 </p>
<ul>
<li>callback：回调函数，应用到每个数组里的每个元素。</li>
<li>array1：数组，遍历运行callback函数。</li>
<li>…：数组列表，每个都遍历运行callback函数。</li>
</ul>
<p>返回值 </p>
<p>返回数组，包含callback函数处理之后array1的所有元素。</p>
<p>说了这么多官方的函数解释，那么这个函数到底如何使用呢？简而言之，这个函数的作用可以这么直白的解释一下。你本来有一个数组，然后我通过array_map函数将你这个数组当作参数传入，然后返回一个新的数组。见下图。</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/005.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$old</span>\_array = <span class="hljs-keyword">array</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">func</span>(<span class="hljs-params"><span class="hljs-variable">$arg</span></span>)</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$arg</span> \* <span class="hljs-variable">$arg</span>;<br>&#125;<br><span class="hljs-variable">$new</span>\_array = <span class="hljs-keyword">array</span>\<span class="hljs-title function_ invoke__">_map</span>(<span class="hljs-string">&#x27;func&#x27;</span>,<span class="hljs-variable">$old</span>\_array);<br><span class="hljs-keyword">var</span>\<span class="hljs-title function_ invoke__">_dump</span>(<span class="hljs-variable">$new</span>\_array);**<span class="hljs-meta">?&gt;</span>**<br>执行结果——&gt;<br><span class="hljs-keyword">array</span>(<span class="hljs-number">5</span>) &#123;<br>[<span class="hljs-number">0</span>]=&gt;<br><span class="hljs-keyword">int</span>(<span class="hljs-number">1</span>)<br>[<span class="hljs-number">1</span>]=&gt;<br><span class="hljs-keyword">int</span>(<span class="hljs-number">4</span>)<br>[<span class="hljs-number">2</span>]=&gt;<br><span class="hljs-keyword">int</span>(<span class="hljs-number">9</span>)<br>[<span class="hljs-number">3</span>]=&gt;<br><span class="hljs-keyword">int</span>(<span class="hljs-number">16</span>)<br>[<span class="hljs-number">4</span>]=&gt;<br><span class="hljs-keyword">int</span>(<span class="hljs-number">25</span>)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>通过上述代码，我们大概知道这个函数就是调用回调函数（用户自定义的函数）来实现对现有数组的操作，从而得到一个新的数组。</p>
<p>那么功能我知道了，可是这个和代码执行有什么关系呢？如何能够利用这个函数执行代码呢？且看下面所示代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$func</span> = <span class="hljs-string">&#x27;system&#x27;</span>;<br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;whoami&#x27;</span>;<br><span class="hljs-variable">$old</span>\_array[<span class="hljs-number">0</span>] = <span class="hljs-variable">$cmd</span>;<br><span class="hljs-variable">$new</span>\_array = <span class="hljs-keyword">array</span>\<span class="hljs-title function_ invoke__">_map</span>(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$old</span>\_array);<br><span class="hljs-keyword">var</span>\<span class="hljs-title function_ invoke__">_dump</span>(<span class="hljs-variable">$new</span>\_array);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;����\cnaqadmin array(1) { [0]&#x3D;&gt; string(14) “����\cnaqadmin” }</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/006.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>这段代码就是，通过array_map()这个函数，来调用用户自定义的函数，而用户这里的回调函数其实就是system函数，那么就相当于我们用system函数来对旧数组进行操作，得到新的数组，那么这个新的数组的结果就是我们想要的命令执行的结果了。</p>
<ul>
<li><h3 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func"></a><strong>call_user_func</strong></h3></li>
</ul>
<p>call_user_func()是把第一个参数作为回调函数调用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">call\_user\<span class="hljs-title function_ invoke__">_func</span>( <span class="hljs-keyword">callable</span> <span class="hljs-variable">$callback</span>[, <span class="hljs-keyword">mixed</span> <span class="hljs-variable">$parameter</span>[, <span class="hljs-keyword">mixed</span> $...]] ) : <span class="hljs-keyword">mixed</span><br></code></pre></td></tr></table></figure>

<p>参数 </p>
<p>第一个参数callback是被调用的回调函数，其余参数是回调函数的参数。</p>
<ul>
<li>callback：即将被调用的回调函数</li>
<li>parameter：传入回调函数的参数</li>
</ul>
<p>这个函数还是非常好理解的，看一段简单的示例代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span></span>)</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span> . <span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br>&#125;<br>call\_user\<span class="hljs-title function_ invoke__">_func</span>(<span class="hljs-string">&#x27;callback&#x27;</span>,<span class="hljs-string">&#x27;我是参数1&#x27;</span>,<span class="hljs-string">&#x27;我是参数2&#x27;</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;</p>
<p>我是参数1</p>
<p>我是参数2</p>
<p>可以看到此函数作用就是调用了笔者自定义的函数。那么这个如何实现代码执行呢？好说，你在前面自定义的函数中加入能执行命令的代码不久可以代码执行了。</p>
<p>示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params"><span class="hljs-variable">$a</span></span>)</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$a</span>);<br>&#125;<br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;whoami&#x27;</span>;<br>call\_user\<span class="hljs-title function_ invoke__">_func</span>(<span class="hljs-string">&#x27;callback&#x27;</span>,<span class="hljs-variable">$cmd</span>);**<span class="hljs-meta">?&gt;</span>**<br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;����\cnaqadmin</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/007.png" srcset="/img/loading.gif" lazyload class="" title="图片">
<ul>
<li><h3 id="call-user-func-array"><a href="#call-user-func-array" class="headerlink" title="call_user_func_array()"></a><strong>call_user_func_array()</strong></h3></li>
</ul>
<p>这个函数名称跟上没什么大的差别，唯一的区别就在于参数的传递上，这个函数是把一个数组作为回调函数的参数</p>
<p>call_user_func_array( callable $callback, array $param_arr) : mixed</p>
<p>参数 </p>
<ul>
<li>callback：被调用的回调函数</li>
<li>param_arr：要被传入回调函数的数组，这个数组需要是索引数组</li>
</ul>
<p>示例代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span></span>)</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$a</span> . <span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>;<br>&#125;<br><span class="hljs-variable">$onearray</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;我是参数1&#x27;</span>,<span class="hljs-string">&#x27;我是参数2&#x27;</span>);<br>call\_user\_func\<span class="hljs-title function_ invoke__">_array</span>(<span class="hljs-string">&#x27;callback&#x27;</span>,<span class="hljs-variable">$onearray</span>);**<span class="hljs-meta">?&gt;</span>**<br></code></pre></td></tr></table></figure>


<p>执行结果——&gt;</p>
<p>我是参数1</p>
<p>我是参数2</p>
<p>示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params"><span class="hljs-variable">$a</span></span>)</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$a</span>);<br>&#125;<br><span class="hljs-variable">$cmd</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br>call\_user\_func\<span class="hljs-title function_ invoke__">_array</span>(<span class="hljs-string">&#x27;callback&#x27;</span>,<span class="hljs-variable">$cmd</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;����\cnaqadmin</p>
<ul>
<li><h3 id="array-filter"><a href="#array-filter" class="headerlink" title="array_filter()"></a><strong>array_filter()</strong></h3></li>
</ul>
<p>用回调函数过滤数数组中的单元</p>
<p>array_filter( array $array[, callable $callback[, int $flag &#x3D; 0]] ) : array</p>
<p>依次将array数组中的每个值传到callback函数。如果callback函数返回true，则array数组的当前值会被包含在返回的结果数组中。数组的键名保留不变。</p>
<p>参数</p>
<ul>
<li>array：要循环的数组</li>
<li>callback：使用的回调函数。如果没有提供callback函数，将删除array中所有等值为FALSE的条目。</li>
<li>flag：决定callback接收的参数形式</li>
</ul>
<p>代码示例（这里看官方的就行，很详细）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">odd</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span>&#123;<br><span class="hljs-comment">// returns whether the input integer is odd</span><br><span class="hljs-keyword">return</span>(<span class="hljs-variable">$var</span> &amp; <span class="hljs-number">1</span>);&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">even</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span>&#123;<br><span class="hljs-comment">// returns whether the input integer is even</span><br><span class="hljs-keyword">return</span>(!(<span class="hljs-variable">$var</span> &amp; <span class="hljs-number">1</span>));&#125;<br><span class="hljs-variable">$array1</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;a&quot;</span>=&gt;<span class="hljs-number">1</span>, <span class="hljs-string">&quot;b&quot;</span>=&gt;<span class="hljs-number">2</span>, <span class="hljs-string">&quot;c&quot;</span>=&gt;<span class="hljs-number">3</span>, <span class="hljs-string">&quot;d&quot;</span>=&gt;<span class="hljs-number">4</span>, <span class="hljs-string">&quot;e&quot;</span>=&gt;<span class="hljs-number">5</span>);<span class="hljs-variable">$array2</span> = <span class="hljs-keyword">array</span>(<span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Odd :\n&quot;</span>;<span class="hljs-keyword">print</span>\<span class="hljs-title function_ invoke__">_r</span>(<span class="hljs-keyword">array</span>\<span class="hljs-title function_ invoke__">_filter</span>(<span class="hljs-variable">$array1</span>, <span class="hljs-string">&quot;odd&quot;</span>));<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Even:\n&quot;</span>;<span class="hljs-keyword">print</span>\<span class="hljs-title function_ invoke__">_r</span>(<span class="hljs-keyword">array</span>\<span class="hljs-title function_ invoke__">_filter</span>(<span class="hljs-variable">$array2</span>, <span class="hljs-string">&quot;even&quot;</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs livescript">Odd :<br><span class="hljs-built_in">Array</span><br>(<br>[a] =&gt; <span class="hljs-number">1</span><br>[c] =&gt; <span class="hljs-number">3</span><br>[e] =&gt; <span class="hljs-number">5</span><br>)<br>Even:<br><span class="hljs-built_in">Array</span><br>(<br>[<span class="hljs-number">0</span>] =&gt; <span class="hljs-number">6</span><br>[<span class="hljs-number">2</span>] =&gt; <span class="hljs-number">8</span><br>[<span class="hljs-number">4</span>] =&gt; <span class="hljs-number">10</span><br>[<span class="hljs-number">6</span>] =&gt; <span class="hljs-number">12</span><br>)<br></code></pre></td></tr></table></figure>

<p>从上面代码我们知道，这个函数作用其实就是过滤，只不过这个过滤调用的是函数，而被过滤的是传入的参数。到这里你心里有没有代码执行的雏形了？</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$cmd</span>=<span class="hljs-string">&#x27;whoami&#x27;</span>;<br><span class="hljs-variable">$array1</span>=<span class="hljs-keyword">array</span>(<span class="hljs-variable">$cmd</span>);<br><span class="hljs-variable">$func</span> =<span class="hljs-string">&#x27;system&#x27;</span>;<br><span class="hljs-keyword">array</span>\<span class="hljs-title function_ invoke__">_filter</span>(<span class="hljs-variable">$array1</span>,<span class="hljs-variable">$func</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;����\cnaqadmin</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/008.png" srcset="/img/loading.gif" lazyload class="" title="图片">
<ul>
<li><h3 id="usort"><a href="#usort" class="headerlink" title="usort()"></a><strong>usort()</strong></h3></li>
</ul>
<p>使用用户自定义的比较函数对数组中的值进行排序</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">usort(<span class="hljs-built_in"> array </span>&amp;$array, callable $value\_compare\_func)<span class="hljs-keyword"> :</span> bool<br></code></pre></td></tr></table></figure>

<p>参数</p>
<ul>
<li>array：输入的数组</li>
<li>cmp_function：在第一个参数小于、等于或大于第二个参数时，该比较函数必须相应地返回一个小于、等于或大于0的数</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">func</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span></span>)</span>&#123;<br><span class="hljs-keyword">return</span> (<span class="hljs-variable">$a</span>&lt;<span class="hljs-variable">$b</span>)?<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-variable">$onearray</span>=<span class="hljs-keyword">array</span>(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">9</span>);<br><span class="hljs-title function_ invoke__">usort</span>(<span class="hljs-variable">$onearray</span>, <span class="hljs-string">&#x27;func&#x27;</span>);<br><span class="hljs-keyword">print</span>\<span class="hljs-title function_ invoke__">_r</span>(<span class="hljs-variable">$onearray</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-built_in">Array</span><br>(<br>[<span class="hljs-number">0</span>] =&gt; <span class="hljs-number">9</span><br>[<span class="hljs-number">1</span>] =&gt; <span class="hljs-number">5</span><br>[<span class="hljs-number">2</span>] =&gt; <span class="hljs-number">3</span><br>[<span class="hljs-number">3</span>] =&gt; <span class="hljs-number">2</span><br>[<span class="hljs-number">4</span>] =&gt; <span class="hljs-number">1</span><br>)<br></code></pre></td></tr></table></figure>

<p>可见实现了逆序的功能。那么倘若我们把回调函数设计成能够执行代码的函数，是不是就可以执行我们想要的代码了呢？</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">usort</span>(...$\_GET);<br><span class="hljs-meta">?&gt;</span><br><br>payload: <span class="hljs-number">1</span>.php?<span class="hljs-number">1</span>[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>&amp;<span class="hljs-number">1</span>[<span class="hljs-number">1</span>]=<span class="hljs-keyword">eval</span>($\_POST[<span class="hljs-string">&#x27;x&#x27;</span>])&amp;<span class="hljs-number">2</span>=assert<br></code></pre></td></tr></table></figure>

<p>POST传参: x&#x3D;phpinfo();</p>
<p>usort的参数通过GET传参，第一个参数也就是$_GET[0]，随便传入一个数字即可。第二个参数也就是$_GET[1]是我们要调用的函数名称，这里采用的是assert函数。</p>
<p>执行结果：</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/009.png" srcset="/img/loading.gif" lazyload class="" title="图片">
<ul>
<li><h3 id="uasort"><a href="#uasort" class="headerlink" title="uasort()"></a><strong>uasort()</strong></h3></li>
</ul>
<p>这个跟上一个差不多，区别不是很大。此函数对数组排序并保持索引和单元之间的关联。也就是说你这个排完序之后呢，它原来对应的索引也会相应改变，类似于“绑定”。</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">uasort(<span class="hljs-built_in"> array </span>&amp;$array, callable $value\_compare\_func)<span class="hljs-keyword"> :</span> bool<br></code></pre></td></tr></table></figure>

<p>1</p>
<p>参数</p>
<ul>
<li>array：输入的数组</li>
<li>value_compare_func：用户自定义的函数</li>
</ul>
<p>这里用的仍然官方例子（比较好理解）</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs perl">&lt;?php<br>// Comparison functionfunction cmp($a, $b) &#123;<br><span class="hljs-keyword">if</span> ($a == $b) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">return</span> ($a &lt; $b) ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>;&#125;<br>// Array to be sorted$array = array(<span class="hljs-string">&#x27;a&#x27;</span> =&gt; <span class="hljs-number">4</span>, <span class="hljs-string">&#x27;b&#x27;</span> =&gt; <span class="hljs-number">8</span>, <span class="hljs-string">&#x27;c&#x27;</span> =&gt; -<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;d&#x27;</span> =&gt; -<span class="hljs-number">9</span>, <span class="hljs-string">&#x27;e&#x27;</span> =&gt; <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;f&#x27;</span> =&gt; <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;g&#x27;</span> =&gt; <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;h&#x27;</span> =&gt; -<span class="hljs-number">4</span>);<span class="hljs-keyword">print</span>\_r($array);<br><br><span class="hljs-regexp">//</span> Sort <span class="hljs-keyword">and</span> <span class="hljs-keyword">print</span> the resulting arrayuasort($array, <span class="hljs-string">&#x27;cmp&#x27;</span>);<span class="hljs-keyword">print</span><br>?&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs livescript">执行结果——&gt;<br><span class="hljs-built_in">Array</span><br>(<br>[a] =&gt; <span class="hljs-number">4</span><br>[b] =&gt; <span class="hljs-number">8</span><br>[c] =&gt; -<span class="hljs-number">1</span><br>[d] =&gt; -<span class="hljs-number">9</span><br>[e] =&gt; <span class="hljs-number">2</span><br>[f] =&gt; <span class="hljs-number">5</span><br>[g] =&gt; <span class="hljs-number">3</span><br>[h] =&gt; -<span class="hljs-number">4</span><br>)<br><span class="hljs-built_in">Array</span><br>(<br>[d] =&gt; -<span class="hljs-number">9</span><br>[h] =&gt; -<span class="hljs-number">4</span><br>[c] =&gt; -<span class="hljs-number">1</span><br>[e] =&gt; <span class="hljs-number">2</span><br>[g] =&gt; <span class="hljs-number">3</span><br>[a] =&gt; <span class="hljs-number">4</span><br>[f] =&gt; <span class="hljs-number">5</span><br>[b] =&gt; <span class="hljs-number">8</span><br>)<br></code></pre></td></tr></table></figure>

<p>我们发现，在排完序之后索引也跟着值的位置变化而变化了。那么代码执行的示例代码其实也和上一个差不多。</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = $\_GET[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$onearray</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;Ameng&#x27;</span>, $\_POST[<span class="hljs-string">&#x27;x&#x27;</span>]);<br><span class="hljs-title function_ invoke__">uasort</span>(<span class="hljs-variable">$onearray</span>, <span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt; ?a&#x3D;assert  POST 传参：x&#x3D;phpinfo();</p>
<h2 id="0x02-命令执行"><a href="#0x02-命令执行" class="headerlink" title="0x02  命令执行"></a><strong>0x02  命令执行</strong></h2><p>说完代码执行，我们再来看看命令执行。常见的命令执行函数有哪些呢？</p>
<ul>
<li><h3 id="system"><a href="#system" class="headerlink" title="system()"></a><strong>system()</strong></h3></li>
</ul>
<p>这个函数想必我们都是比较熟悉的，此函数就是执行外部指令，并且显示输出</p>
<p>system( string $command[, int &amp;$return_var] ) : string</p>
<p>参数</p>
<ul>
<li>command：必需。要执行的命令</li>
<li>return_var：可选。若设置了这个参数，那么命令执行后的返回状态就会被放到这个变量中</li>
</ul>
<p>示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;whoami&#x27;</span>;<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$cmd</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;����\cnaqadmin</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/010.png" srcset="/img/loading.gif" lazyload class="" title="图片">
<ul>
<li><h3 id="exec"><a href="#exec" class="headerlink" title="exec()"></a><strong>exec()</strong></h3></li>
</ul>
<p>这个其实和上面system函数没有太大区别，都是执行外部程序指令，只不过这个函数多了一个参数，可以让我们把命令执行输出的结果保存到一个数组中。</p>
<p>exec( string $command[, array &amp;$output[, int &amp;$return_var]] ) : string</p>
<p>参数 </p>
<ul>
<li>command：必需。要执行的命令</li>
<li>output：可选。如果设置了此参数，那么命令执行的结果将会保存到此数组。</li>
<li>return_var：可选。命令执行的返回状态。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;whoami&#x27;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$cmd</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;</p>
<p>执行结果——&gt;����\cnaqadmin</p>
<ul>
<li><h3 id="shell-exec"><a href="#shell-exec" class="headerlink" title="shell_exec()"></a><strong>shell_exec()</strong></h3></li>
</ul>
<p> <br>此函数通过shell环境执行命令，并且将完整的输出以字符串的方式返回。如果执行过程中发生错误或者进程不产生输出，那么就返回NULL</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">shell\_exec( <span class="hljs-built_in">string</span> $cmd) : <span class="hljs-built_in">string</span><br></code></pre></td></tr></table></figure>

<p>参数 </p>
<ul>
<li>cmd：要执行的命令</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;whoami&#x27;</span>;<span class="hljs-keyword">echo</span> shell\<span class="hljs-title function_ invoke__">_exec</span>(<span class="hljs-variable">$cmd</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;</p>
<p>执行结果——&gt;����\cnaqadmin</p>
<ul>
<li><h3 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a><strong>passthru()</strong></h3></li>
</ul>
<p>执行外部程序并且显示原始输出。既然我们已经有执行命令的函数了，那么这个函数我们什么时候会用到呢？当所执行的Unix命令输出二进制数据，并且需要直接传送到浏览器的时候，需要用此函数来替代exec()或system()函数</p>
<p>passthru( string $command[, int &amp;$return_var] ) : void</p>
<p>参数 </p>
<ul>
<li>command：要执行的命令</li>
<li>return_var：Unix命令的返回状态将被记录到此函数。</li>
</ul>
<p>代码示例：</p>
<p>第一你可以这么写</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">passthru</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>);	<span class="hljs-comment">//直接将结果返回到页面</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>第二你可以这么写</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">passthru</span>(<span class="hljs-string">&#x27;whoami&#x27;</span>,<span class="hljs-variable">$result</span>);	<span class="hljs-comment">//将结果返回到一个变量，然后通过输出变量值得到输出内容</span><br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h3 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec()"></a><strong>pcntl_exec()</strong></h3></li>
</ul>
<p>在当前进程空间执行指定程序。关键点就在于进程空间，倘若我现在设定一个条件，你只有在某个子进程中才能读取phpinfo，那这个时候，我们就需要用到这个函数了。</p>
<p>pcntl_exec( string $path[, array $args[, array $envs]] ) : void</p>
<p>参数 </p>
<ul>
<li>path：path必须时可执行二进制文件路径或在一个文件第一行指定了一个可执行文件路径标头的脚本(比如文件第一行是#!&#x2F;usr&#x2F;local&#x2F;bin&#x2F;perl的perl脚本)</li>
<li>args：此参数是一个传递给程序的参数的字符串数组</li>
<li>envs：环境变量，这个想必大家都很熟悉，只不过这里强调一点，这里传入的是数组，数组格式是 key &#x3D;&gt; value格式的，key代表要传递的环境变量的名称，value代表该环境变量值。</li>
</ul>
<p>示例代码：</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">//father</span><span class="language-php"><span class="hljs-meta">&lt;?php</span></span><br><span class="language-php">pcntl\<span class="hljs-title function_ invoke__">_exec</span>(<span class="hljs-string">&#x27;/usr/local/bin/php&#x27;</span>, [<span class="hljs-string">&#x27;2.php&#x27;</span>]);</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span></span><br><span class="language-php"><span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;</span><br><span class="language-php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;ok&#x27;</span>;</span><br><span class="language-php"></span><br><span class="language-php">&#125;</span><br><span class="language-php"><span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure>

<ul>
<li><h3 id="popen"><a href="#popen" class="headerlink" title="popen()"></a><strong>popen()</strong></h3></li>
</ul>
<p> <br>此函数使用command参数打开进程文件指针。如果出错，那么该函数就会返回FALSE。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">popen</span><span class="hljs-params">(command,mode)</span></span><br></code></pre></td></tr></table></figure>

<p>参数 </p>
<ul>
<li>command：要执行的命令</li>
<li>mode：必需。规定连接的模式<ul>
<li>r：只读</li>
<li>w：只写（打开并清空已有文件或创建一个新文件）</li>
</ul>
</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">popen</span>(<span class="hljs-string">&quot;demo.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);<br><span class="hljs-title function_ invoke__">pclose</span>(<span class="hljs-variable">$file</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">popen</span>(<span class="hljs-string">&quot;/bin/ls&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);<span class="hljs-comment">//some code to be executedpclose($file);?&gt;</span><br></code></pre></td></tr></table></figure>


<ul>
<li><h3 id="proc-open"><a href="#proc-open" class="headerlink" title="proc_open()"></a><strong>proc_open()</strong></h3></li>
</ul>
<p>此函数执行一个命令，并且打开用来输入或者输出的文件指针</p>
<p>proc_open( string $cmd, array $descriptorspec, array &amp;$pipes[, string $cwd &#x3D; NULL[, array $env &#x3D; NULL[, array $other_options &#x3D; NULL]]] ) </p>
<p>此函数其实和popen函数类似，都是执行命令</p>
<p>参数 </p>
<ul>
<li>cmd：要执行的命令</li>
<li>descriptorspec：索引数组。数组中的键值表示描述符，元素值表示 PHP 如何将这些描述符传送至子进程。0 表示标准输入（stdin），1 表示标准输出（stdout），2 表示标准错误（stderr）。</li>
<li>pipes：将被置为索引数组，其中的元素是被执行程序创建的管道对应到PHP这一段的文件指针。</li>
<li>cwd：要执行命令的初始工作目录。必需是绝对路径。此参数默认使用 NULL（表示当前 PHP 进程的工作目录）</li>
<li>env。要执行命令所使用的环境变量。此参数默认为 NULL（表示和当前 PHP 进程相同的环境变量）</li>
<li>other_options：可选。附加选项<ul>
<li>suppress_errors （仅用于 Windows 平台）：设置为 TRUE 表示抑制本函数产生的错误。</li>
<li>bypass_shell （仅用于 Windows 平台）：设置为 TRUE 表示绕过 cmd.exe shell。</li>
</ul>
</li>
</ul>
<p>说白了，其实就是执行命令，只不过其中多了一些选项，包括目录的，环境变量的等。</p>
<p>示例代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$descriptorspec</span> = <span class="hljs-keyword">array</span>(<br><span class="hljs-number">0</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>),	<span class="hljs-comment">//标准输入，子进程从此管道读取数据</span><br><span class="hljs-number">1</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>),	<span class="hljs-comment">//标准输出，子进程向此管道写入数据</span><br><span class="hljs-number">2</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;/opt/figli/php/error-output.txt&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>)	<span class="hljs-comment">//标准错误，写入到指定文件</span><br>);<br><span class="hljs-variable">$process</span> = proc\<span class="hljs-title function_ invoke__">_open</span>(<span class="hljs-string">&quot;ls -a&quot;</span>, <span class="hljs-variable">$descriptorspec</span>, <span class="hljs-variable">$pipes</span>);<br><span class="hljs-keyword">if</span>(is\<span class="hljs-title function_ invoke__">_resource</span>(<span class="hljs-variable">$process</span>))&#123;<br><span class="hljs-keyword">echo</span> stream\_get\<span class="hljs-title function_ invoke__">_contents</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>]);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>]);<br>proc\<span class="hljs-title function_ invoke__">_close</span>(<span class="hljs-variable">$process</span>);	<span class="hljs-comment">//在调用proc\_close之前必须关闭所有管道</span><br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="0x03-文件包含"><a href="#0x03-文件包含" class="headerlink" title="0x03  文件包含"></a><strong>0x03  文件包含</strong></h2><ul>
<li><h3 id="include"><a href="#include" class="headerlink" title="include()"></a><strong>include()</strong></h3></li>
</ul>
<p> <br>include将会包含语句并执行指定文件</p>
<p>include ‘filename’;</p>
<p>关键点就在于执行指定文件，执行给了我们代码执行的机会。倘若此时我们构造了一个后门文件，需要在目标机器执行进行shell反弹，那么如果代码中有include而且没有进行过滤，那么我们就可以使用该函数来执行我们的后门函数。下面我来演示一下。</p>
<p>示例代码(3.php)：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight\<span class="hljs-title function_ invoke__">_file</span>(\_\_FILE\_\_);<br><span class="hljs-variable">$file</span> = $\_GET[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$file</span>;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>示例代码(2.php)：（上面得命令执行代码）</p>
<p>执行结果：</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/011.png" srcset="/img/loading.gif" lazyload class="" title="图片">
<ul>
<li><h3 id="include-once"><a href="#include-once" class="headerlink" title="include_once()"></a><strong>include_once()</strong></h3></li>
</ul>
<p>include_once与include没有太大区别，唯一的其区别已经在名称中体现了，就是相同的文件只包含一次。其他功能和include_once一样，只是增加对每个文件包含的次数。</p>
<ul>
<li><h3 id="require"><a href="#require" class="headerlink" title="require()"></a><strong>require()</strong></h3></li>
</ul>
<p> <br>require的实现和include功能几乎完全相同，那既然一样为什么还要多一个这样的函数呢？( 我也不知道)</p>
<p>其实两者还是有点区别的，什么区别呢？这么说，如果你包含的文件的代码里面有错误，你觉得会发生什么？是继续执行包含的文件，还是停止执行呢？所以区别就在这里产生了。</p>
<p>require在出错时会导致脚本终止，而include在出错时只是发生警告，脚本还是继续执行。</p>
<ul>
<li><h3 id="require-once"><a href="#require-once" class="headerlink" title="require_once()"></a><strong>require_once()</strong></h3></li>
</ul>
<p> <br>这个我觉得你看完上面的，应该就懂了。这两者关系和include与include_once的关系是一样的。</p>
<p>文件包含有很多利用手段，其中在实际环境中，例如我们向服务器写入了后门，但是我们无法直接连接服务器，那么如果有文件包含函数，我们可以通过文件包含函数包含执行我们的后门函数，让服务器反弹连接我们。岂不美哉。</p>
<h2 id="0x04-文件读取（下载）"><a href="#0x04-文件读取（下载）" class="headerlink" title="0x04  文件读取（下载）"></a><strong>0x04  文件读取（下载）</strong></h2><ul>
<li><h3 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a><strong>file_get_contents()</strong></h3></li>
</ul>
<p>函数功能是将整个文件读入一个字符串</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">file\<span class="hljs-variable">_get</span>\<span class="hljs-variable">_contents</span>(path,include\<span class="hljs-variable">_path</span>,context,start,<span class="hljs-built_in">max</span>\<span class="hljs-variable">_length</span>)<br></code></pre></td></tr></table></figure>

<p>参数</p>
<ul>
<li>filename：要读取文件的名称。</li>
<li>include_path：可选。如果也想在 include_path 中搜索文件，可以设置为1。</li>
<li>context：可选。规定句柄的位置。</li>
<li>start：可选。规定文件中开始读取的位置。</li>
<li>max_length：可选。规定读取的字节数。</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> file\_get\<span class="hljs-title function_ invoke__">_contents</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;qwer asd zxcxz</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/012.png" srcset="/img/loading.gif" lazyload class="" title="图片">
<ul>
<li><h3 id="fopen"><a href="#fopen" class="headerlink" title="fopen()"></a><strong>fopen()</strong></h3></li>
</ul>
<p>此函数将打开一个文件或URL，如果 fopen() 失败，它将返回 FALSE 并附带错误信息。我们可以通过在函数名前面添加一个 @ 来隐藏错误输出。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">fopen</span><span class="hljs-params">(filename,mode,include\_path,context)</span></span><br></code></pre></td></tr></table></figure>

<p>参数</p>
<ul>
<li>filename：必需。要打开的文件或URL</li>
<li>mode：必需。规定访问类型（例如只读，只写，读写方式等，方式的规定和其他语言的规定方式一致）</li>
<li>include_path：可选。就是你可以指定搜索的路径位置，如果要指定的话，那么该参数要指定为1</li>
<li>context：可选。规定句柄的环境。</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&quot;demo.txt&quot;</span>,<span class="hljs-string">&quot;rb&quot;</span>);<br><span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$file</span>,<span class="hljs-number">1024</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$content</span>;<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$file</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;qwer asd zxcxz</p>
<p>这段代码中其实也包含了fread的用法。因为fread仅仅只是打开一个文件，要想读取还得需要用到fread来读取文件内容。</p>
<ul>
<li><h3 id="fread"><a href="#fread" class="headerlink" title="fread()"></a><strong>fread()</strong></h3></li>
</ul>
<p>这个函数刚才在上个函数中基本已经演示过了，就是读取文件内容。这里代码就不再演示了，简单介绍一下参数和用法。</p>
<p>string fread ( resource $handle , int $length )</p>
<p>参数</p>
<ul>
<li>handle：文件系统指针，是典型地由 fopen创建的resource。</li>
<li>length：必需。你要读取的最大字节数。</li>
<li><h3 id="fgets"><a href="#fgets" class="headerlink" title="fgets()"></a><strong>fgets()</strong></h3></li>
</ul>
<p>从打开的文件中读取一行</p>
<p>fgets(file,length) </p>
<p>参数 </p>
<ul>
<li>file：必需。规定要读取的文件。</li>
<li>length：可选。规定要读取的字节数。默认是1024字节。</li>
</ul>
<p>可以看出这个函数和之前的fread区别不是很大，只不过这个读取的是一行。</p>
<ul>
<li><h3 id="fgetss"><a href="#fgetss" class="headerlink" title="fgetss()"></a><strong>fgetss()</strong></h3></li>
</ul>
<p>这个函数跟上个没什么差别，也是从打开的文件中读取去一行，只不过过滤掉了 HTML 和 PHP 标签。</p>
<p>fgetss(file,length,tags)</p>
<p>参数 </p>
<ul>
<li>file：必需。要检查的文件。</li>
<li>length：可选。规定要读取的字节数，默认1024字节。</li>
<li>tags：可选。哪些标记不去掉。</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&quot;demo.html&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">fgetss</span>(<span class="hljs-variable">$file</span>);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$file</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>demo.html代码demo</p>
<p>执行结果——&gt;</p>
<p>demo</p>
<ul>
<li><h3 id="readfile"><a href="#readfile" class="headerlink" title="readfile()"></a><strong>readfile()</strong></h3></li>
</ul>
<p>这个函数从名称基本就知道它是干啥的了，读文件用的。此函数将读取一个文件，并写入到输出缓冲中。如果成功，该函数返回从文件中读入的字节数。如果失败，该函数返回 FALSE 并附带错误信息。</p>
<p>readfile(filename,include_path,context)</p>
<p>参数</p>
<ul>
<li>filename：必需。要读取的文件。</li>
<li>include_path：可选。规定要搜索的路径。</li>
<li>context：可选。规定文件句柄环境。</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span> . <span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-string">&quot;demo.txt&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;demo</p>
<p>我们看到不仅输出了所有内容，而且还输出了总共长度。但是没有输出换行。</p>
<ul>
<li><h3 id="file"><a href="#file" class="headerlink" title="file()"></a><strong>file()</strong></h3></li>
</ul>
<p>把文件读入到一个数组中，数组中每一个元素对应的是文件中的一行，包括换行符。</p>
<p>file(path,include_path,context)</p>
<p>参数</p>
<ul>
<li>path：必需。要读取的文件。</li>
<li>include_path：可选。可指定搜索路径。</li>
<li>context：可选。设置句柄环境。</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span>Php<br><span class="hljs-keyword">print</span>\<span class="hljs-title function_ invoke__">_r</span>(<span class="hljs-title function_ invoke__">file</span>(<span class="hljs-string">&quot;test.txt&quot;</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt; Array ( [0] &#x3D;&gt; qwer [1] &#x3D;&gt; asd[2] &#x3D;&gt; zxcxz )</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/013.png" srcset="/img/loading.gif" lazyload class="" title="图片">
<ul>
<li><h3 id="parse-ini-file"><a href="#parse-ini-file" class="headerlink" title="parse_ini_file()"></a><strong>parse_ini_file()</strong></h3></li>
</ul>
<p>从名称可以看出，这个函数不是读取一个简单的文件。它的功能是解析一个配置文件(ini文件)，并以数组的形式返回其中的位置。</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">parse\_ini\_file(file,process\_sections)<br></code></pre></td></tr></table></figure>

<p>参数</p>
<ul>
<li>file：必需。要读取的ini文件</li>
<li>process_sections：可选。若为TRUE，则返回一个多维数组，包括了详细信息</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">print</span>\<span class="hljs-title function_ invoke__">_r</span>(parse\_ini\<span class="hljs-title function_ invoke__">_file</span>(<span class="hljs-string">&quot;demo.ini&quot;</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>demo.ini内容：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[names]</span><br><span class="hljs-attr">me</span> = Robert<br><span class="hljs-attr">you</span> = Peter<br><br><span class="hljs-section">[urls]</span><br><span class="hljs-attr">first</span> = <span class="hljs-string">&quot;http://www.example.com&quot;</span><br><span class="hljs-attr">second</span> = <span class="hljs-string">&quot;https://www.baidu.com&quot;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;Array ( [me] &#x3D;&gt; Robert [you] &#x3D;&gt; Peter [first] &#x3D;&gt; <a target="_blank" rel="noopener" href="http://www.example1.com/">http://www.example1.com</a> [second] &#x3D;&gt; <a target="_blank" rel="noopener" href="https://www.example2.com/">https://www.example2.com</a> )</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/014.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>文件读取这块内容没什么好说的，不难，大多只是基本的应用。重点文件读取如果没有设置权限和过滤参数，那就问题大了，我们就可以任意文件读取了。</p>
<p>补充：什么是句柄？</p>
<p>开局先给一段代码</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">$file = <span class="hljs-keyword">fopen</span>(<span class="hljs-string">&quot;demo.txt&quot;</span>,<span class="hljs-string">&quot;rb&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>在这段代码中$file就是一个句柄。句柄关键点在“柄”，后面的fopen是一个资源，好比一口锅，而前面的$file就好比这个锅的把手。那么以后我们在操作的时候操作把手就行了。通过这个把手我们可以间接操作比较大的资源。其实也类似C语言中的指针，只是一个标识。</p>
<h2 id="0x05-文件上传"><a href="#0x05-文件上传" class="headerlink" title="0x05  文件上传"></a><strong>0x05  文件上传</strong></h2><ul>
<li><h3 id="move-uploaded-file"><a href="#move-uploaded-file" class="headerlink" title="move_uploaded_file()"></a><strong>move_uploaded_file()</strong></h3></li>
</ul>
<p>此函数是将上传的文件移动到新位置。</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">move\_uploaded\<span class="hljs-built_in">_file</span>(file,newloc)<br></code></pre></td></tr></table></figure>

<p>参数</p>
<ul>
<li>file：必需。规定要移动的文件。</li>
<li>newloc：必需。规定文件的新位置。</li>
</ul>
<p>本函数检查并确保由 file 指定的文件是合法的上传文件（即通过 PHP 的 HTTP POST 上传机制所上传的）。如果文件合法，则将其移动为由 newloc 指定的文件。</p>
<p>如果 file 不是合法的上传文件，不会出现任何操作，move_uploaded_file() 将返回 false。</p>
<p>如果 file 是合法的上传文件，但出于某些原因无法移动，不会出现任何操作，move_uploaded_file() 将返回 false，此外还会发出一条警告。</p>
<p>代码示例：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">$fileName = $\_SERVER[<span class="hljs-string">&#x27;DOCUMENT\_ROOT&#x27;</span>].<span class="hljs-string">&#x27;/uploads/&#x27;</span>.$\_FILES[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<span class="hljs-keyword">move</span>\_uploaded\_file($\_FILES[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp\_name&#x27;</span>],$fileName )<br></code></pre></td></tr></table></figure>

<p>这段代码就是直接接收上传的文件，没有进行任何的过滤，那么当我们上传getshell的后门时，就可以直接获取权限，可见这个函数是不能乱用的，即便要用也要将过滤规则完善好，防止上传不合法文件。</p>
<h2 id="0x06-文件删除"><a href="#0x06-文件删除" class="headerlink" title="0x06  文件删除"></a><strong>0x06  文件删除</strong></h2><ul>
<li><h3 id="unlink"><a href="#unlink" class="headerlink" title="unlink()"></a><strong>unlink()</strong></h3></li>
</ul>
<p>此函数用来删除文件。成功返回 TURE ，失败返回 FALSE。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">unlink</span><span class="hljs-params">(filename,context)</span></span><br></code></pre></td></tr></table></figure>

<p>参数</p>
<ul>
<li>filename：必需。要删除的文件。</li>
<li>context：可选。句柄环境。</li>
</ul>
<p>我们知道，一些网站是有删除功能的。比如常见的论坛网站，是有删除评论或者文章功能的。倘若网站没有对删除处做限制，那么就可能会导致任意文件删除（甚至删除网站源码）。</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;demo.txt&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>))&#123;<br><span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$file</span> have been deleted&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$file</span> not exist?&quot;</span>)<br>&#125;<br>php&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li><h3 id="session-destroy"><a href="#session-destroy" class="headerlink" title="session_destroy()"></a><strong>session_destroy()</strong></h3></li>
</ul>
<p>在了解这个函数之前，我们需要先了解 PHP session。 PHP session 变量用于存储关于用户会话的信息。关于 sesson 的机制这里我就不再过于详细介绍。</p>
<p>session_destroy()函数用来销毁一个会话中的全部数据，但并不会重置当前会话所关联的全局变量，同时也不会重置会话 cookie</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// 初始化会话。// 如果要使用会话，别忘了现在就调用：session\_start();</span><br><span class="hljs-comment">// 重置会话中的所有变量$\_SESSION = array();</span><br><span class="hljs-comment">// 如果要清理的更彻底，那么同时删除会话 cookie// 注意：这样不但销毁了会话中的数据，还同时销毁了会话本身if (ini\_get(&quot;session.use\_cookies&quot;)) &#123;</span><br><span class="hljs-variable">$params</span> = session\_get\_cookie\<span class="hljs-title function_ invoke__">_params</span>();<br><span class="hljs-title function_ invoke__">setcookie</span>(session\<span class="hljs-title function_ invoke__">_name</span>(), <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-title function_ invoke__">time</span>() - <span class="hljs-number">42000</span>,<br><span class="hljs-variable">$params</span>[<span class="hljs-string">&quot;path&quot;</span>], <span class="hljs-variable">$params</span>[<span class="hljs-string">&quot;domain&quot;</span>],<br><span class="hljs-variable">$params</span>[<span class="hljs-string">&quot;secure&quot;</span>], <span class="hljs-variable">$params</span>[<span class="hljs-string">&quot;httponly&quot;</span>]<br>);&#125;<br><span class="hljs-comment">// 最后，销毁会话session\_destroy();</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="0x07-变量覆盖"><a href="#0x07-变量覆盖" class="headerlink" title="0x07  变量覆盖"></a><strong>0x07  变量覆盖</strong></h2><ul>
<li><h3 id="extract"><a href="#extract" class="headerlink" title="extract()"></a><strong>extract()</strong></h3></li>
</ul>
<p> <br>此函数从数组中将变量导入到当前的符号表。其实作用就是给变量重新赋值，从而达到变量覆盖的作用。</p>
<p>extract(array,extract_rules,prefix)</p>
<p>参数 </p>
<ul>
<li>array：必需。规定要使用的数组。</li>
<li>extract_rules：可选。extract函数将检查每个键名是否为合法的变量名，同时也检查和符号中已经存在的变量名是否冲突，对不合法或者冲突的键名将会根据此参数的设定的规则来决定。<ul>
<li>EXTR_OVERWRITE - 默认。如果有冲突，则覆盖已有的变量。</li>
<li>EXTR_SKIP - 如果有冲突，不覆盖已有的变量。</li>
<li>EXTR_PREFIX_SAME - 如果有冲突，在变量名前加上前缀 prefix。</li>
<li>EXTR_PREFIX_ALL - 给所有变量名加上前缀 prefix。</li>
<li>EXTR_PREFIX_INVALID - 仅在不合法或数字变量名前加上前缀 prefix。</li>
<li>EXTR_IF_EXISTS - 仅在当前符号表中已有同名变量时，覆盖它们的值。其它的都不处理。</li>
<li>EXTR_PREFIX_IF_EXISTS - 仅在当前符号表中已有同名变量时，建立附加了前缀的变量名，其它的都不处理。</li>
<li>EXTR_REFS - 将变量作为引用提取。导入的变量仍然引用了数组参数的值。</li>
</ul>
</li>
<li>prefix：可选。如果 extract_rules 参数的值是 EXTR_PREFIX_SAME、EXTR_PREFIX_ALL、 EXTR_PREFIX_INVALID 或 EXTR_PREFIX_IF_EXISTS，则 prefix 是必需的。</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$color</span> = <span class="hljs-string">&quot;blue&quot;</span>;<br><span class="hljs-variable">$one</span>\_array = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;color&quot;</span> =&gt; <span class="hljs-string">&quot;red&quot;</span>,<br><span class="hljs-string">&quot;size&quot;</span>  =&gt; <span class="hljs-string">&quot;medium&quot;</span>,<br><span class="hljs-string">&quot;name&quot;</span> =&gt; <span class="hljs-string">&quot;dog&quot;</span>);<br><span class="hljs-title function_ invoke__">extract</span>(<span class="hljs-variable">$one</span>\_array);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$color</span>, <span class="hljs-subst">$size</span>, <span class="hljs-subst">$name</span>&quot;</span>;**<span class="hljs-meta">?&gt;</span>**<br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;</p>
<p>red, medium, dog</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/015.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>在上述代码中，我们看到，本来我们定义的color是blue，输出的时候变成了red，本来我们没有定义size和name，可是却能输出这两个变量。</p>
<p>还有一些在CTF比赛中出现过的用法，比如直接让你POST传参来改变某个变量的值。</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;cat&#x27;</span>;<br><span class="hljs-title function_ invoke__">extract</span>($\_POST);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$name</span>;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>参时如果我们POST传入name&#x3D;dog，那么页面将会回显dog，说明这个函数的使用让我们实现了变量的覆盖，改变了变量的值。</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/016.png" srcset="/img/loading.gif" lazyload class="" title="图片">
<ul>
<li><h3 id="parse-str"><a href="#parse-str" class="headerlink" title="parse_str()"></a><strong>parse_str()</strong></h3></li>
</ul>
<p>此函数把查询到的字符串解析到变量中。</p>
<p>parse_str(string,array)</p>
<p>参数 </p>
<ul>
<li>string：必需。规定要解析的字符串。</li>
<li>array：可选。规定存储变量的数组名称。该参数只是变量存储到数组中。</li>
</ul>
<p>代码示例:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>parse\<span class="hljs-title function_ invoke__">_str</span>(<span class="hljs-string">&quot;name=Ameng&amp;sex=boy&quot;</span>,<span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">print</span>\<span class="hljs-title function_ invoke__">_r</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-built_in">Array</span><br>(<br>[name] =&gt; Ameng<br>[sex] =&gt; boy<br>)<br></code></pre></td></tr></table></figure>

<p>上述代码是有array情况下的使用情况，那么如何实现变量的覆盖呢？如果没有array 参数，则由该函数设置的变量将覆盖已存在的同名变量。</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;who&#x27;</span>;<br><span class="hljs-variable">$age</span> = <span class="hljs-string">&#x27;20&#x27;</span>;<br>parse\<span class="hljs-title function_ invoke__">_str</span>(<span class="hljs-string">&quot;name=Ameng&amp;age=21&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$name</span>, <span class="hljs-subst">$age</span>&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;</p>
<p>Ameng, 21</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/017.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>通过上述代码，我们可以发现，变量name和age都发生了变化，被新的值覆盖了。这里我用的是 PHP 7.4.3 版本。发现这个函数的这个作用还是存在的，且没有任何危险提示。</p>
<ul>
<li><h3 id="import-request-variables"><a href="#import-request-variables" class="headerlink" title="import_request_variables()"></a><strong>import_request_variables()</strong></h3></li>
</ul>
<p>此函数将GET&#x2F;POST&#x2F;Cookie变量导入到全局作用域中。从而能够达到变量覆盖的作用。</p>
<p>版本要求：PHP 4 &gt;&#x3D; 4.1.0, PHP 5 &lt; 5.4.0</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">bool <span class="hljs-keyword">import</span>\_request\_variables ( <span class="hljs-built_in">string</span> $types <span class="hljs-meta">[</span>, <span class="hljs-built_in">string</span> $prefix <span class="hljs-meta">]</span> )<br></code></pre></td></tr></table></figure>

<p>参数 </p>
<ul>
<li>types：指定需要导入的变量，可以用字母 G、P 和 C 分别表示 GET、POST 和 Cookie，这些字母不区分大小写，所以你可以使用 g 、 p 和 c 的任何组合。POST 包含了通过 POST 方法上传的文件信息。注意这些字母的顺序，当使用 gp 时，POST 变量将使用相同的名字覆盖 GET 变量。</li>
<li>prefix：变量名的前缀，置于所有被导入到全局作用域的变量之前。所以如果你有个名为 userid 的 GET 变量，同时提供了 pref_ 作为前缀，那么你将获得一个名为 $pref_userid 的全局变量。虽然 prefix 参数是可选的，但如果不指定前缀，或者指定一个空字符串作为前缀，你将获得一个 E_NOTICE 级别的错误。</li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;who&#x27;</span>;<br>import\_request\<span class="hljs-title function_ invoke__">_variables</span>(<span class="hljs-string">&#x27;gp&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$name</span> == <span class="hljs-string">&#x27;Ameng&#x27;</span>)&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$name</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You are not Ameng&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>如果什么变量也不传，那么页面将回显You are not Ameng如果通过GET或者POST传入name&#x3D;Ameng那么页面就会回显Ameng</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/018.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/019.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>可以见到此函数还是很危险的，没有修复方法，不使用就是最好的方法。所以在新版本的 PHP 中已经废弃了这个函数。</p>
<ul>
<li><h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach()"></a><strong>foreach()</strong></h3></li>
</ul>
<p>foreach 语法结构提供了遍历数组的简单方式。foreach 仅能够应用于数组和对象，如果尝试应用于其他数据类型的变量，或者未初始化的变量将发出错误信息。有两种语法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">array</span>\_expression <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>)<br><span class="hljs-title function_ invoke__">statementforeach</span> (<span class="hljs-keyword">array</span>\_expression <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>)<br>statement<br></code></pre></td></tr></table></figure>

<p>第一种格式遍历给定的 array_expression 数组。每次循环中，当前单元的值被赋给 $value 并且数组内部的指针向前移一步（因此下一次循环中将会得到下一个单元）。</p>
<p>第二种格式做同样的事，只是除了当前单元的键名也会在每次循环中被赋给变量 $key。</p>
<p>那么这个函数如何实现变量的覆盖呢？我们来看个案例.</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$name</span> = <span class="hljs-string">&#x27;who&#x27;</span>;<br><span class="hljs-keyword">foreach</span>($\_GET <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>)	&#123;  <br><span class="hljs-variable">$$key</span> = <span class="hljs-variable">$value</span>;  <br>&#125;  <br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$name</span> == <span class="hljs-string">&quot;Ameng&quot;</span>)&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You are right!&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You are flase!&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/020.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>那么执行结果是怎样的呢？当我们直接打开页面的时候它会输出You are false!,而当我们通过GET传参name&#x3D;Ameng的时候，它会回显You are right!。那么这是为什么呢？我们来分析一下</p>
<p>关键点就在于$$这种写法。这种写法称为可变变量。一个变量能够获取一个普通变量的值作为这个可变变量的变量名。当使用foreach来遍历数组中的值，然后再将获取到的数组键名作为变量，数组中的键值作为变量的值。这样就产生了变量覆盖漏洞，如上代码示例。其执行过程为$$key&#x3D;$name，最后赋值为$value，从而实现了变量覆盖。</p>
<h2 id="0x08-弱类型比较"><a href="#0x08-弱类型比较" class="headerlink" title="0x08  弱类型比较"></a><strong>0x08  弱类型比较</strong></h2><ul>
<li><h3 id="md5-函数和sha1-绕过"><a href="#md5-函数和sha1-绕过" class="headerlink" title="md5()函数和sha1()绕过"></a>md5()函数和sha1()绕过</h3></li>
</ul>
<p>关于这两个函数想必我们不陌生，无论是在实际代码审计中，还是在CTF比赛中，这些我们都是碰到过的函数。那么当我们遇到用这两个函数来判断的时候，如果绕过呢？</p>
<p>PHP 在处理哈希字符串的时候，会使用!&#x3D;或者&#x3D;&#x3D;来对哈希值进行比较，它会把每一个0E开头的哈希值都解释为0，那么这个时候问题就来了，如果两个不同的值，经过哈希以后它们都变成了0E开头的哈希值，那么 PHP 就会将它们视作相等处理。那么0E开头的哈希值有哪些呢？</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs dns">s878926199a<br><span class="hljs-number">0</span>e5459932745177090343<span class="hljs-number">28855841020</span><br>s155964671a<br><span class="hljs-number">0</span>e342768416822451524<span class="hljs-number">974117254469</span><br>s214587387a<br><span class="hljs-number">0</span>e8482404488305379244<span class="hljs-number">65865611904</span><br>s214587387a<br><span class="hljs-number">0</span>e8482404488305379244<span class="hljs-number">65865611904</span><br>s878926199a<br><span class="hljs-number">0</span>e5459932745177090343<span class="hljs-number">28855841020</span><br>s1091221200a<br><span class="hljs-number">0</span>e9406242178565615578<span class="hljs-number">16327384675</span><br>s1885207154a<br><span class="hljs-number">0</span>e5093672134182067008<span class="hljs-number">42008763514</span><br>s1502113478a<br><span class="hljs-number">0</span>e8615801632915612474<span class="hljs-number">04381396064</span><br>s1885207154a<br><span class="hljs-number">0</span>e5093672134182067008<span class="hljs-number">42008763514</span><br>s1836677006a<br><span class="hljs-number">0</span>e4810364908676611132<span class="hljs-number">60034900752</span><br>s155964671a<br><span class="hljs-number">0</span>e342768416822451524<span class="hljs-number">974117254469</span><br>s1184209335a<br><span class="hljs-number">0</span>e072485820392773389<span class="hljs-number">523109082030</span><br>s1665632922a<br><span class="hljs-number">0</span>e731198061491163073<span class="hljs-number">197128363787</span><br>s1502113478a<br><span class="hljs-number">0</span>e8615801632915612474<span class="hljs-number">04381396064</span><br>s1836677006a<br><span class="hljs-number">0</span>e4810364908676611132<span class="hljs-number">60034900752</span><br>s1091221200a<br><span class="hljs-number">0</span>e9406242178565615578<span class="hljs-number">16327384675</span><br>s155964671a<br><span class="hljs-number">0</span>e342768416822451524<span class="hljs-number">974117254469</span><br>s1502113478a<br><span class="hljs-number">0</span>e8615801632915612474<span class="hljs-number">04381396064</span><br>s155964671a<br><span class="hljs-number">0</span>e342768416822451524<span class="hljs-number">974117254469</span><br>s1665632922a<br><span class="hljs-number">0</span>e731198061491163073<span class="hljs-number">197128363787</span><br>s155964671a<br><span class="hljs-number">0</span>e342768416822451524<span class="hljs-number">974117254469</span><br>s1091221200a<br><span class="hljs-number">0</span>e9406242178565615578<span class="hljs-number">16327384675</span><br>s1836677006a<br><span class="hljs-number">0</span>e4810364908676611132<span class="hljs-number">60034900752</span><br>s1885207154a<br><span class="hljs-number">0</span>e5093672134182067008<span class="hljs-number">42008763514</span><br>s532378020a<br><span class="hljs-number">0</span>e220463095855511507<span class="hljs-number">588041205815</span><br>s878926199a<br><span class="hljs-number">0</span>e5459932745177090343<span class="hljs-number">28855841020</span><br>s1091221200a<br><span class="hljs-number">0</span>e9406242178565615578<span class="hljs-number">16327384675</span><br>s214587387a<br><span class="hljs-number">0</span>e8482404488305379244<span class="hljs-number">65865611904</span><br>s1502113478a<br><span class="hljs-number">0</span>e8615801632915612474<span class="hljs-number">04381396064</span><br>s1091221200a<br><span class="hljs-number">0</span>e9406242178565615578<span class="hljs-number">16327384675</span><br>s1665632922a<br><span class="hljs-number">0</span>e731198061491163073<span class="hljs-number">197128363787</span><br>s1885207154a<br><span class="hljs-number">0</span>e5093672134182067008<span class="hljs-number">42008763514</span><br>s1836677006a<br><span class="hljs-number">0</span>e4810364908676611132<span class="hljs-number">60034900752</span><br>s1665632922a<br><span class="hljs-number">0</span>e731198061491163073<span class="hljs-number">197128363787</span><br>s878926199a<br><span class="hljs-number">0</span>e5459932745177090343<span class="hljs-number">28855841020</span><br></code></pre></td></tr></table></figure>

<p>来个简单的例子吧</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br>	<span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$a</span>) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$b</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;这就是弱类型绕过&#x27;</span>;<br>    &#125;<br>	<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;再思考一下&#x27;</span>;<br>&#125;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/021.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>从上面我给出的哪些值中，挑两个不同的值传入参数，就能看到相应的结果</p>
<p>上面是md5()函数的绕过姿势，那么sha1()如何绕过呢？再来看一个简单的例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$a</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br>    <span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$a</span>) === <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$b</span>))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nice!!!&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Try again!&#x27;</span>;<br>        &#125;<br>    &#125;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/022.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>当我们传入a[]&#x3D;1&amp;b[]&#x3D;2的时候，虽然它会给出警告，说我们应该传入字符串而不应该是数组，但是它还是输出了nice!!!，所以我们完全可以用数字来绕过sha1()函数的比较。</p>
<ul>
<li><h3 id="is-numeric-绕过"><a href="#is-numeric-绕过" class="headerlink" title="is_numeric()绕过"></a><strong>is_numeric()绕过</strong></h3></li>
</ul>
<p>我们先来了解一下这个函数。此函数是检测变量是否为数字或者数字字符串</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">is</span>\_numeric( mixed $<span class="hljs-keyword">var</span>) : <span class="hljs-built_in">bool</span><br></code></pre></td></tr></table></figure>

<p>如果var是数字或者数字字符串那么就返回TRUE，否则就返回FALSE。那么这里说的绕过是什么姿势呢？是十六进制。我们先来看一个简单的例子。</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-string">&#x27;0x31206f722031&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$a</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;It meets my requirement&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Try again&#x27;</span>;<br>    &#125;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>执行结果——&gt;</p>
<p>It meets my requirement</p>
<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/023.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>这里说一下0x31206f722031这个是什么？这个是or 1&#x3D;1的十六进制，从这里可以看出，如果某处使用了此函数，并将修饰后的变量带入数据库查询语句中，那么我们就能利用此漏洞实现sql注入。同样的，这个漏洞再CTF比赛中也是很常见的。</p>
<ul>
<li><h3 id="in-array-绕过"><a href="#in-array-绕过" class="headerlink" title="in_array()绕过"></a><strong>in_array()绕过</strong></h3></li>
</ul>
<p>此函数用来检测数组中是否存在某个值。</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">in\_array( mixed $needle,<span class="hljs-built_in"> array </span>$haystack[, bool $strict = FALSE] )<span class="hljs-keyword"> :</span> bool<br></code></pre></td></tr></table></figure>

<p>参数 </p>
<ul>
<li>needle：带搜索的值(区分大小写)。</li>
<li>haystack：带搜索的数组。</li>
<li>strict：若此参数的值为TRUE，那么in_array()函数将会检查needle的类型是否和haystack中的类型相同。</li>
</ul>
<p>有时候我们再传入一个数组的时候，代码可能会过滤某些敏感字符串，但是我们又需要传入这样的字符串，那么我们应该如何绕过它的检测呢？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$myarr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;Ameng&#x27;</span>);<br>    <span class="hljs-variable">$needle</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$needle</span>,<span class="hljs-variable">$myarr</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;It&#x27;s in array&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;not in array&quot;</span>;<br>&#125;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/024.png" srcset="/img/loading.gif" lazyload class="" title="图片">

<p>上面代码示例执行的结果会是什么呢？从简单的逻辑上分析。0是不存在要搜索的数组中的，所以理论上，应该是输出not in array，但是实际却输出了It’s in array。这是为什么呢？原因就在于PHP的默认类型转换。这里我们第三个参数并没有设置为true那么默认就是非严格比较，所以在数字与字符串进行比较时，字符串先被强制转换成数字，然后再进行比较。并且因为某些类型转换正在发生，就会导致发生数据丢失，并且都被视为相同。所以归根到底还是非严格比较导致的问题。所以再遇到这个函数用来变量检测的时候，我们可以看看第三个参数是否开启，若未开启，则存在数组绕过。</p>
<h2 id="0x09-XSS"><a href="#0x09-XSS" class="headerlink" title="0x09  XSS"></a><strong>0x09  XSS</strong></h2><p>在这里首先你要对XSS的基本原理要知道。PHP中一下这些函数之所以会出现XSS的漏洞情况，主要还是没有对输出的变量进行过滤。</p>
<ul>
<li><h3 id="print"><a href="#print" class="headerlink" title="print()"></a><strong>print()</strong></h3></li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$str</span> = $\_GET[<span class="hljs-string">&#x27;x&#x27;</span>];<br><span class="hljs-keyword">print</span>(<span class="hljs-variable">$str</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<img src="/2024/09/20/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/025.png" srcset="/img/loading.gif" lazyload class="" title="图片">
<ul>
<li><h3 id="print-r"><a href="#print-r" class="headerlink" title="print_r()"></a><strong>print_r()</strong></h3></li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;x&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$str</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h3 id="echo"><a href="#echo" class="headerlink" title="echo()"></a><strong>echo()</strong></h3></li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;x&#x27;</span>];<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$str</span>&quot;</span>;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h3 id="printf"><a href="#printf" class="headerlink" title="printf()"></a><strong>printf()</strong></h3></li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;x&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">printf</span>(<span class="hljs-variable">$str</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h3 id="sprintf"><a href="#sprintf" class="headerlink" title="sprintf()"></a><strong>sprintf()</strong></h3></li>
</ul>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;x&#x27;</span>];<br>    <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-variable">$str</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$a</span>&quot;</span>;<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h3 id="die"><a href="#die" class="headerlink" title="die()"></a><strong>die()</strong></h3></li>
</ul>
<p>此函数输出一条信息，并退出当前脚本。</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;x&#x27;</span>];<br>    <span class="hljs-keyword">die</span>(<span class="hljs-variable">$str</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>


<ul>
<li><h3 id="var-dump"><a href="#var-dump" class="headerlink" title="var_dump()"></a><strong>var_dump()</strong></h3></li>
</ul>
<p>此函数打印变量的相关信息，用来显示关于一个或多个表达式的结构信息，包括表达式的类型与值。数组将递归展开之，通过缩进显示其结构。</p>
<p>代码示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;x&#x27;</span>];<br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$str</span>);<br>    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$a</span>);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="0x10-总结"><a href="#0x10-总结" class="headerlink" title="0x10  总结"></a><strong>0x10  总结</strong></h2><p>学习代码审计之前，需要从两个方向出发，第一是需要从开发者角度出发去思考问题，可以快速定位问题；学习面向对象编程以及面向过程编程，编写一些项目提升对代码的理解能力；再是对各种漏洞可以独立挖掘利用并能理解漏洞的危害。</p>
<p>一切存在用户输入的地方都有可能存在漏洞。审计路线：Demo-&gt;综合漏洞靶场-&gt;网上审计过的CMS-&gt;多入口CMS-&gt;单入口CMS-&gt;框架-&gt;函数缺陷。个人能力有限，部分可能会出现错误或者遗漏，读者可自行补充。有时间笔者会出一篇关于代审的续集~</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="category-chain-item">php代码审计</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="print-no-link">#代码审计</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>php代码审计基础</div>
      <div>http://aqiao-jashell.github.io/2024/09/20/php代码审计基础/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>CNAQ</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年9月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/09/28/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%802/" title="php代码审计基础2">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">php代码审计基础2</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/10/18/%E4%BB%A3%E7%90%86%E4%B8%8E%E8%BD%AC%E5%8F%91/" title="代理与转发">
                        <span class="hidden-mobile">代理与转发</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
